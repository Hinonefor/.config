import CrxDownloader from"./crx-download.js";import Awesome from"../dynamic/awesome.js";export default(function(){let e={},t={"download-crx":{icon:"♥",text:"插件下载分享",onClick:function(e,t){CrxDownloader.downloadCrx(t)}},"fehelper-setting":{icon:"❂",text:"FeHelper设置",onClick:function(e,t){chrome.runtime.openOptionsPage()}}},n=(t,n)=>{if(["fehelper-setting","json-format"].includes(t)){if("0"===Awesome.menuMgr(t,"get"))return!1}else if("download-crx"===t){if("1"!==Awesome.menuMgr(t,"get"))return!1}else if(!Awesome.detectInstall(t,!0))return!1;n&&n.forEach&&n.forEach(n=>{chrome.contextMenus.create({title:n.icon+"  "+n.text,contexts:n.contexts||["all"],parentId:e.contextMenuId,onclick:n.onClick||function(e,n){chrome.DynamicToolRunner({query:`tool=${t}`})}})})},o=function(){e.contextMenuId&&(chrome.contextMenus.remove(e.contextMenuId),e.contextMenuId=null)};return{manage:function(c){c.getOptions(c=>{c.OPT_ITEM_CONTEXTMENUS?function(){o(),e.contextMenuId=chrome.contextMenus.create({title:"FeHelper",contexts:["page","selection","editable","link","image"],documentUrlPatterns:["http://*/*","https://*/*","file://*/*"]});let c={},r=Awesome.allTools;Object.keys(r).forEach(e=>{n(e,r[e].menuConfig)}),["download-crx","fehelper-setting"].forEach(e=>{c[e]||n(e,[t[e]])})}():o()})}}}());