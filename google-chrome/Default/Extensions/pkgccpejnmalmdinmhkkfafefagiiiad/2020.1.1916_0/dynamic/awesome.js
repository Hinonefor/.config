let Awesome=(()=>{let manifest=chrome.runtime.getManifest();const SERVER_SITE=manifest.homepage_url,URL_TOOL_TPL=`${SERVER_SITE}/#TOOL-NAME#/index.html`,TOOL_NAME_TPL="DYNAMIC_TOOL:#TOOL-NAME#",TOOL_CONTENT_SCRIPT_TPL="DYNAMIC_TOOL:CS:#TOOL-NAME#",TOOL_CONTENT_SCRIPT_CSS_TPL="DYNAMIC_TOOL:CS:CSS:#TOOL-NAME#",TOOL_MENU_TPL="DYNAMIC_MENU:#TOOL-NAME#",TOOLS_FROM_REMOTE="TOOLS_FROM_REMOTE";let detectInstall=(e,t,o)=>{if("json-format"===e&&!o)return!t||"1"===localStorage.getItem(TOOL_MENU_TPL.replace("#TOOL-NAME#",e));return!(null===localStorage.getItem(TOOL_NAME_TPL.replace("#TOOL-NAME#",e)))&&(!t||"1"===localStorage.getItem(TOOL_MENU_TPL.replace("#TOOL-NAME#",e)))},log=e=>{},_tplHandler=(e,t)=>{let o={};return[/<link\s+[^>]*stylesheet[^>]*href=['"]([^'"]+)['"][^>]*>/gim,/<script[^>]*src=['"]([^'"]+)['"][^>]*>\s*?<\/[^>]*script>/gim].forEach(n=>{t=t.replace(n,(t,n)=>{let l=n,a=n;if(-1!==n.indexOf("?")){let e=n.split("?");e.pop(),n=e.join("")}if(/^\./.test(n)||(n=`../${e}/${n}`,a=`../${e}/${a}`),"../static/js/navbar.js"!==n){let r=`${SERVER_SITE}/${e}/${l}`,s=/<script/.test(t)?"js":"css";o[s]=o[s]||[],o[s].push([n,a,r])}return""})}),{html:t=t.replace("static/img/favicon.ico","static/img/fe-16.png").replace(/<body/gm,"<body browser-extension").replace(/<div\s+class="mod-pageheader">.*<\/div>\s*<div\sclass="panel\spanel-default"/gm,'<div class="panel panel-default"').replace(/<div\sid="pageFooter"\s+[^>]+>\s*<script\s.*<\/script>\s*<\/div>/gm,"").replace(/<\/body>/,()=>Object.keys(o).map(e=>`<dynamic data-type="${e}" data-source="${o[e].map(e=>e[1]).join(",")}"></dynamic>`).join("")+"</body>"),jsCss:o}},install=(toolName,fnProgress)=>(log(toolName+"工具开始安装/更新..."),new Promise((resolve,reject)=>{try{fetch(URL_TOOL_TPL.replace("#TOOL-NAME#",toolName)).then(e=>{if(e.ok)return fnProgress&&fnProgress("1%"),e.text();reject&&reject({status:e.status,statusText:e.statusText})}).then(html=>{let result=_tplHandler(toolName,html);html=result.html;let files=result.jsCss;localStorage.setItem(TOOL_NAME_TPL.replace("#TOOL-NAME#",toolName),html),log(toolName+"工具html模板安装/更新成功！");let total=eval(Object.values(files).map(e=>e.length).join("+"))+1,loaded=1;fnProgress&&fnProgress(Math.floor(100*loaded/total)+"%"),(async()=>{for(let e in files)for(let t=0;t<files[e].length;t++){let o=files[e][t];await fetch(o[2]).then(e=>e.text()).then(e=>{localStorage.setItem(o[0],e),allTools[toolName].contentScript&&-1!==o[0].indexOf(toolName+"/content-script.js")&&(localStorage.setItem(TOOL_CONTENT_SCRIPT_TPL.replace("#TOOL-NAME#",toolName),e),allTools[toolName].contentScriptCss&&fetch(o[2].replace("content-script.js","content-script.css")).then(e=>e.text()).then(e=>{localStorage.setItem(TOOL_CONTENT_SCRIPT_CSS_TPL.replace("#TOOL-NAME#",toolName),e)})),log(`${toolName}工具静态文件${o[0]}安装/更新成功！`),fnProgress&&fnProgress(Math.floor(100*++loaded/total)+"%")})}log(toolName+"工具安装/更新成功！"),resolve&&resolve("100%")})()})}catch(e){reject&&reject(e)}})),offLoad=e=>new Promise(t=>{localStorage.removeItem(TOOL_NAME_TPL.replace("#TOOL-NAME#",e)),localStorage.removeItem(TOOL_CONTENT_SCRIPT_TPL.replace("#TOOL-NAME#",e)),localStorage.removeItem(TOOL_CONTENT_SCRIPT_CSS_TPL.replace("#TOOL-NAME#",e)),log(e+" 卸载成功！"),t&&t()}),getInstalledTools=()=>Object.keys(allTools).filter(e=>detectInstall(e)),getContentScript=(e,t)=>t?localStorage.getItem(TOOL_CONTENT_SCRIPT_CSS_TPL.replace("#TOOL-NAME#",e)):localStorage.getItem(TOOL_CONTENT_SCRIPT_TPL.replace("#TOOL-NAME#",e)),checkUpgrade=e=>{return(e=>fetch(URL_TOOL_TPL.replace("#TOOL-NAME#",e)).then(e=>e.text()))(e).then(t=>{let o=_tplHandler(e,t);return(e=>localStorage.getItem(TOOL_NAME_TPL.replace("#TOOL-NAME#",e)))(e)!==o.html})},menuMgr=(e,t)=>"get"===t?localStorage.getItem(TOOL_MENU_TPL.replace("#TOOL-NAME#",e)):new Promise(o=>{"offload"===t?(localStorage.setItem(TOOL_MENU_TPL.replace("#TOOL-NAME#",e),0),log(e+" 卸载成功！")):"install"===t&&(localStorage.setItem(TOOL_MENU_TPL.replace("#TOOL-NAME#",e),1),log(e+" 安装成功！")),o&&o()}),allTools=(()=>{let toolMap={"json-format":{name:"JSON美化工具",tips:"支持JSON页面自动格式化、手动格式化、Unicode解码、JSON排序、BigInt、JSON编辑、下载等",contentScript:!0,contentScriptCss:!0,offloadForbid:!0,menuConfig:[{icon:"★",text:"JSON格式化",contexts:["page","selection","editable"]}]},"json-diff":{name:"JSON比对工具",tips:"支持两个JSON内容的自动键值比较，并高亮显示差异点，同时也能判断JSON是否合法",menuConfig:[{icon:"☃",text:"JSON比对器"}]},"qr-code":{name:"二维码/解码",tips:"支持自定义颜色和icon的二维码生成器，并且支持多种模式的二维码解码，包括截图后粘贴解码",menuConfig:[{icon:"▣",text:"二维码生成器",contexts:["page","selection","editable","link","image"]},{icon:"◈",text:"二维码解码器",contexts:["image"]}]},"image-base64":{name:"图片转Base64",tips:"支持多种模式的图片直接转Base64格式，比如链接粘贴/截图粘贴等，也支持Base64数据逆转图片",menuConfig:[{icon:"▤",text:"图片与base64",contexts:["image"]}]},"sticky-notes":{name:"我的便签笔记",tips:"方便快捷的浏览器便签笔记工具，支持创建目录对笔记进行分类管理，笔记支持一键导出/导入",menuConfig:[{icon:"▤",text:"我的便签笔记"}]},"en-decode":{name:"信息编码转换",tips:"支持多种格式的信息编解码，包括Unicode、UTF-8、UTF-16、URL、Base64、MD5、Hex、Gzip等",menuConfig:[{icon:"♨",text:"字符串编解码",contexts:["page","selection","editable"]}]},"code-beautify":{name:"代码美化工具",tips:"支持多语言格式的内容美化，包括 Javascript、CSS、HTML、XML、SQL，且会陆续支持更多格式",menuConfig:[{icon:"✡",text:"代码美化工具",contexts:["page","selection","editable"]}]},timestamp:{name:"时间(戳)转换",tips:"本地化时间与时间戳之间的相互转换，支持秒/毫秒、支持世界时区切换、世界各时区时钟展示等",menuConfig:[{icon:"♖",text:"时间(戳)转换"}]},password:{name:"随机密码生成",tips:"将各种字符进行随机组合生成密码，密码可以由数字、大小写字母、特殊符号组成，支持指定长度",menuConfig:[{icon:"☽",text:"随机密码生成"}]},html2markdown:{name:"Markdown转换",tips:"Markdown编写/预览工具，支持HTML片段直接转Markdown，并支持将内容以PDF格式进行下载",menuConfig:[{icon:"ⓜ",text:"markown工具"}]},postman:{name:"简易Postman",tips:"开发过程中的接口调试工具，支持GET/POST/HEAD请求方式，且支持JSON内容自动格式化",menuConfig:[{icon:"☯",text:"简易Postman"}]},regexp:{name:"JS正则表达式",tips:"正则校验工具，默认提供一些工作中常用的正则表达式，支持内容实时匹配并高亮显示结果",menuConfig:[{icon:"✙",text:"JS正则表达式"}]},"trans-radix":{name:"进制转换工具",tips:"支持2进制到36进制数据之间的任意转换，比如：10进制转2进制，8进制转16进制，等等",menuConfig:[{icon:"❖",text:"进制转换工具"}]},"trans-color":{name:"颜色转换工具",tips:"支持HEX颜色到RGB格式的互转，比如HEX颜色「#43ad7f」转RGB后为「rgb(67, 173, 127)」",menuConfig:[{icon:"▶",text:"颜色转换工具"}]},crontab:{name:"Crontab工具",tips:"一个简易的Crontab生成工具，支持随机生成Demo，编辑过程中，分时日月周会高亮提示",menuConfig:[{icon:"☠",text:"Crontab生成"}]},"loan-rate":{name:"贷(还)款利率",tips:"贷款或还款利率的计算器，按月呈现还款计划；并支持按还款额反推贷款实际利率",menuConfig:[{icon:"〓",text:"贷(还)款利率"}]}};Object.keys(toolMap).forEach(e=>{switch(toolMap[e].installed=toolMap[e].offloadForbid,toolMap[e].menu=toolMap[e].offloadForbid,toolMap[e].upgrade=!1,e){case"json-format":toolMap[e].menuConfig[0].onClick=function(e,t){chrome.tabs.executeScript(t.id,{code:"("+function(e){return e.selectionText}.toString()+")("+JSON.stringify(e)+")",allFrames:!1},function(e){chrome.DynamicToolRunner({tool:"json-format",withContent:e[0]})})};break;case"code-beautify":case"en-decode":toolMap[e].menuConfig[0].onClick=function(t,o){chrome.tabs.executeScript(o.id,{code:"("+function(e){let t=e.linkUrl,o=e.pageUrl,n=e.srcUrl,l=e.selectionText;return t||n||l||o}.toString()+")("+JSON.stringify(t)+")",allFrames:!1},function(t){chrome.DynamicToolRunner({withContent:t[0],query:`tool=${e}`})})};break;case"qr-code":toolMap[e].menuConfig[0].onClick=function(e,t){chrome.tabs.executeScript(t.id,{code:"("+function(e){let t=e.linkUrl,o=e.pageUrl,n=e.srcUrl,l=e.selectionText;return t||n||l||o}.toString()+")("+JSON.stringify(e)+")",allFrames:!1},function(e){chrome.DynamicToolRunner({withContent:e[0],query:"tool=qr-code"})})},toolMap[e].menuConfig[1].onClick=function(e,t){chrome.tabs.executeScript(t.id,{code:"("+function(e){var t;return(t=e.srcUrl,new Promise(e=>{let o=new Image;o.setAttribute("crossOrigin","Anonymous"),o.src=t,o.onload=function(){let t=this.naturalWidth,n=this.naturalHeight,l=document.createElement("canvas");l.style.cssText="position:absolute;top:-10000px;left:-10000px",document.body.appendChild(l),l.setAttribute("id","qr-canvas"),l.height=n+100,l.width=t+100;let a=l.getContext("2d");a.fillStyle="rgb(255,255,255)",a.fillRect(0,0,l.width,l.height),a.drawImage(o,0,0,t,n,50,50,t,n),e(l.toDataURL())},o.onerror=function(){e(t)}})).then(e=>{window.__TEMP_DATA_URL_FOR_QRDECODE_=e}),"__TEMP_DATA_URL_FOR_QRDECODE_"}.toString()+")("+JSON.stringify(e)+")",allFrames:!1},function(o){let n=o[0],l=-1,a=0,r=function(){a++,l=setInterval(function(){chrome.tabs.executeScript(t.id,{code:"("+function(e){return window[e]}.toString()+")("+JSON.stringify(n)+")",allFrames:!1},function(t){null===t[0]&&a<=10?r():(clearInterval(l),chrome.DynamicToolRunner({withContent:t[0]||e.srcUrl,query:"tool=qr-code&mode=decode"}))})},200)};r()})};break;default:toolMap[e].menuConfig[0].onClick=function(t,o){chrome.DynamicToolRunner({withContent:"MENU_IMAGE_BASE64"===e?t.srcUrl:"",query:`tool=${e}`})}}});try{let jsText=localStorage.getItem(TOOLS_FROM_REMOTE);eval(jsText),Object.keys(RemoteAwesome.newTools).forEach(e=>{toolMap[e]?(toolMap[e].name=RemoteAwesome.newTools[e].name||toolMap[e].name,toolMap[e].tips=RemoteAwesome.newTools[e].tips||toolMap[e].tips,toolMap[e].menuConfig=RemoteAwesome.newTools[e].menuConfig||toolMap[e].menuConfig,void 0!==RemoteAwesome.newTools[e].contentScript&&(toolMap[e].contentScript=RemoteAwesome.newTools[e].contentScript),void 0!==RemoteAwesome.newTools[e].contentScriptCss&&(toolMap[e].contentScriptCss=RemoteAwesome.newTools[e].contentScriptCss),void 0!==RemoteAwesome.newTools[e].offloadForbid&&(toolMap[e].offloadForbid=RemoteAwesome.newTools[e].offloadForbid)):toolMap[e]=RemoteAwesome.newTools[e]}),RemoteAwesome.removedTools.forEach(e=>{delete toolMap[e]})}catch(e){}return Object.keys(toolMap).forEach(e=>{detectInstall(e)&&(toolMap[e].installed=!0,toolMap[e].menu="json-format"===e?"0"!==menuMgr(e,"get"):detectInstall(e,!0))}),toolMap})();return{detectInstall:detectInstall,install:install,offLoad:offLoad,getInstalledTools:getInstalledTools,menuMgr:menuMgr,checkUpgrade:checkUpgrade,getContentScript:getContentScript,allTools:allTools,TOOLS_FROM_REMOTE:TOOLS_FROM_REMOTE}})();export default Awesome;