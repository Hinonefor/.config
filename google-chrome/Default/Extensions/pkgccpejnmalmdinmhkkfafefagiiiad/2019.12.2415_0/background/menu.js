import MSG_TYPE from"../static/js/common.js";import CrxDownloader from"./crx-download.js";export default(function(){let e={},t=function(){e.contextMenuId&&(chrome.contextMenus.remove(e.contextMenuId),e.contextMenuId=null)};return{manage:function(n,o){n.getOptsFromBgPage(c=>{c.OPT_ITEM_CONTEXTMENUS?function(n,o){t(),e.contextMenuId=chrome.contextMenus.create({title:"FeHelper.JSON",contexts:["page","selection","editable","link","image"],documentUrlPatterns:["http://*/*","https://*/*","file://*/*"]}),Object.keys(n).forEach(t=>{let c={MENU_JSON_FORMAT:function(e,t){chrome.tabs.executeScript(t.id,{code:"("+function(e){return e.selectionText}.toString()+")("+JSON.stringify(e)+")",allFrames:!1},function(e){o(MSG_TYPE.JSON_FORMAT,"object"==typeof e?e[0]:e)})},MENU_MORE_FE_TOOLS:function(e,t){chrome.tabs.create({url:chrome.runtime.getManifest().homepage_url,active:!0})},MENU_DOWNLOAD_CRX:function(e,t){CrxDownloader.downloadCrx(t)}};chrome.contextMenus.create({title:n[t].icon+"  "+n[t].text,contexts:n[t].contexts||["all"],parentId:e.contextMenuId,onclick:c[t]})})}(n.getMenuOpts(),o):t()})}}}());