'use strict';(k=>{const d=c=>{const a=(()=>{let a,c;const b=[];b.notify=a=>{b.forEach(c=>{c(a)})};const e=[];e._push=e.push;e.push=(...a)=>{e._push.apply(e,a);e.check()};e.check=()=>{if(void 0!==a){let b;for(;e.length;)if(b=e.shift(),void 0===b.state||b.state===a)c=("function"===typeof b.f?b.f.call(g,c):b.f)||c}};var g={promise:function(){return g},done:function(a){e.push({state:!0,f:a});return g},fail:function(a){e.push({state:!1,f:a});return g},always:function(a){e.push({f:a});return g},progress:function(a){b.push(a);
return g},then:function(a,b,e){return d(d=>{[{fn:"done",forward:"resolve",f:a},{fn:"fail",forward:"reject",f:b},{fn:"progress",forward:"notify",f:e}].forEach(a=>{g[a.fn]((...b)=>{const e="function"===typeof a.f,f=e?a.f(c):void 0;f&&"function"===typeof f.promise?f.promise().done(d.resolve).fail(d.reject).progress(d.notify):d[a.forward].apply(d,e?[f]:b)})})}).promise()},each:function(a){return g.then((b,...c)=>{b instanceof Array||(b=[b,...c]);return d.when(b.map(b=>a(b)))})},iterate:function(a){return g.then((b,
...c)=>{b instanceof Array||(b=[b,...c]);let e=0;const f=d(),h=()=>{if(e<b.length){var c=b[e++];(c=a(c))&&c.promise?c.promise().done(h).fail(f.reject):h()}else f.resolve(b)};h();return f.promise()})}};return{get:function(){return g},try_resolve:function(b){void 0===a&&(a=!0,c=b);e.check();return g},try_reject:function(b){void 0===a&&(a=!1,c=b);e.check();return g},do_notify:function(a){b.notify(a)}}})(),b={promise:function(){return a.get()},resolve:function(){return a.try_resolve.apply(this,arguments)},
reject:function(){return a.try_reject.apply(this,arguments)},notify:function(){return a.do_notify.apply(this,arguments)},consume:function(a){a.promise().done(b.resolve).fail(b.reject).progress(b.notify);return b.promise()}};c&&c(b);return b};d.Pledge=c=>{const a=d();a.resolve(c);return a.promise()};d.Breach=c=>{const a=d();a.reject(c);return a.promise()};d.onebyone=c=>{let a=[];return c.reduce((b,c)=>{const f=d();b.always(()=>{c().done(b=>{a=a.concat(b instanceof Array?b:[b])}).fail(()=>{a=a.concat(null)}).always(f.resolve)});
return f.promise()},d.Pledge()).then(()=>a)};d.or=c=>{let a;const b=d(),f=()=>{c.length?(a=c.shift())&&d.Pledge().then(a).done(a=>{b.resolve(a)}).fail(f):b.reject()};f();return b.promise()};d.sidebyside=(c,...a)=>{c instanceof Array||(c=[c,...a]);const b=d();let f=c.length;f?c.forEach(a=>{a&&a.promise&&a.promise().always(()=>{0===--f&&b.resolve()})}):b.resolve();return b.promise()};d.when=(c,...a)=>{c instanceof Array||(c=[c,...a]);const b=d();let f=c.length;const h=[];f?c.forEach(a=>{a&&a.promise?
a.promise().fail(()=>{b.reject(h);f=-1}).done(a=>{h.push(a);0===--f&&b.resolve(h)}):console.warn("promise: incompatible object given to when()",a)}):b.resolve(h);return b.promise()};d.sleep=c=>{const a=d();window.setTimeout(a.resolve,c);return a.promise()};k.Registry?k.Registry.register("promise","7c765150",()=>d):"undefined"!==typeof require?module.exports.Deferred=d:k.Deferred=d})("undefined"!==typeof window?window:global);
