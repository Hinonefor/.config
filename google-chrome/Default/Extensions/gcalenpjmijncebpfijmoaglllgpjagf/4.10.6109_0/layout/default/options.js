'use strict';window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("promise layout convert xmlhttprequest crcrc curtain tools layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter parser hinter cloud".split(" "),()=>{const A=rea.FEATURES,B=Registry.get("promise"),y=Registry.get("crcrc").cr,g=Registry.get("crcrc").crc,Na=Registry.get("layout/default/tabview"),n=Registry.get("layout/default/htmlutil"),ob=Registry.get("statistics"),ha=Registry.get("syncinfo"),ia=Registry.get("convert"),
Oa=Registry.get("tools"),p=Registry.get("curtain"),c=Registry.get("i18n"),w=Registry.get("helper"),ua=Registry.get("uri"),da=Registry.get("porter"),Pa=window.Hinter=Registry.get("hinter"),pb=Registry.get("parser"),Qa=Registry.get("layout"),pa=Registry.get("layout/default/layout_helper"),C=pa.images,Ra=Registry.get("cloud"),Ba=Oa.cache;let Ca;Qa.render(()=>{const va={};let u={};const J=[];let Sa="0.0.0";const aa={},Ta={};let Y={};const D=(()=>{let a;let b,d,e;if(a=A.HTML5.LOCALSTORAGE){var c=a.getItem("export_tm_settings");
b="true"===c;c=a.getItem("export_externals");d="false"!==c;c=a.getItem("export_script_storage");e="false"!==c;if(c=a.getItem("cloud_config"))try{c=JSON.parse(ia.Base64.decode(c))}catch(m){}}return{script_storage:e,add_tm_settings:b,include_externals:d,cloud_config:c}})();let I;const v={},O=function(a,b){let c,e;if((c=v[a])&&(e=c[b]))return e.apply(this,Array.prototype.slice.call(arguments,2))},qa=a=>{var b=a.msg||a;if(a.once){if(Ta[b])return!0;Ta[b]=!0}b=confirm(b);let c={};b&&a.ok?c=a.ok:!b&&a.cancel&&
(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},()=>{});return b},wa=(a,b)=>{try{const c=()=>{b&&A.OPTIONPAGE.CLOSE_ALLOWED&&window.close()};b?sendMessage({method:"newTab",url:a},c):rea.tabs.getSelected(null,e=>{rea.tabs.sendMessage(e.id,{method:"loadUrl",url:a,newtab:b},c)})}catch(d){console.log("lU: "+d.message)}};let Ua=!1;const Va=a=>{if(!Ua){var b=c.getLocale(),d=$("<div>").hide(),e=a=>{a?(d.html(""),d.append($('<div class="contrib_iframe" style="font-size: 2.5em;"></div>').append($('<div style="padding-top: 150px;">').text(a))),
window.setTimeout(e,1E3)):(d.fadeOut(1E3),window.setTimeout(p.hideDialog,1E3))};a=$('<iframe src="https://www.tampermonkey.net/contrib.php?embedded=2'+(b?"&locale="+b:"")+"&src="+(a||"e")+'" class="contrib_iframe"></iframe>');var f=[$('<button class="contrib_button">').html(c.getMessage("Remind_me_later")).click(()=>{ja("later");e(c.getMessage("Ok"))}),$('<button class="contrib_button">').html(c.getMessage("I_contributed_already")).click(()=>{ja("contributed");e(c.getMessage("Thank_you_very_much_"))}),
$('<button class="contrib_button">').html(c.getMessage("I_dont_want_to_contribute")).click(()=>{ja("hide");e(c.getMessage("Ok"))})],m=()=>{h&&window.clearTimeout(h);f.forEach(a=>{a.prop("disabled",!1)})};f.forEach(a=>{a.prop("disabled",!0)});d.append(a,f);a.bind("load",m);var h=window.setTimeout(()=>{h=null;m()},15E3),l=()=>{const a=p.dialog(d[0]);!0===a?(d.fadeIn(1E3),ja("dialog")):void 0===a&&window.setTimeout(l,500);Ua=!0};l();window.addEventListener("message",a=>{const b=a.data.clicked||a.data.type;
var k=a.data.amount;var f=a.data.currency;const h=a.data.redirect_url;b&&(h&&wa(h,!0),a.data.success?(k=$(".contrib_iframe"),f=k.data("oheight"),!f||0>f||1E3<f||(k.animate({height:f},1E3),ja("contributed",b,{id:a.data.id}))):a.data.clicked&&(ja("clicked",b,{amount:k||"?",currency:f||"?"}),$(".contrib_button").remove(),d.append($('<button class="contrib_button">').html(c.getMessage("Ok")).click(()=>{e()})),a.data.enlarge&&(k=$(".contrib_iframe"),k.data("oheight",k.height()),k.animate({height:740},
1E3))))},!1)}},ea=()=>{if(A.HTML5.LOCALSTORAGE)return A.HTML5.LOCALSTORAGE.getItem("sort_key")},ka=()=>{if(A.HTML5.LOCALSTORAGE)return A.HTML5.LOCALSTORAGE.getItem("sort_sequence")},Wa=a=>{if(A.HTML5.LOCALSTORAGE)return A.HTML5.LOCALSTORAGE.setItem("sort_key",a)},Xa=a=>{if(A.HTML5.LOCALSTORAGE)return A.HTML5.LOCALSTORAGE.setItem("sort_sequence",a)},Ya=a=>{const b=(a,c)=>a.tagName==c?a:a.parentNode?b(a.parentNode,c):null;let d="down"==ka(),e=null,f=[],m=0;const h=Date.now();Object.keys(Y).forEach(a=>
{const d=Y[a];if(d)if(a=b(d.dom,"TR")){const k=b(a,"TBODY");e?k&&e!=k&&console.warn("options: different parents?!?!"):e=k;m++;let l,q;if(!(l=d.script.lastModified||d.script.lastUpdated)||(q=h-parseInt(l))&&isNaN(q))q=0;f.push({tr:a,sites:Da.get(d.script),enabled:d.script.enabled,position:d.script.position?d.script.position:1E3+m,name:c.getTranslation(d.script,"name").toLowerCase(),homepage:[d.script.origin?ua.parse(d.script.origin.url).hostname:"z",Ea(d.script)?ua.parse(Ea(d.script)).hostname:"z"].join("_"),
updated:q,version:d.script.version||""});a.inserted=!1;a.parentNode&&a.parentNode.removeChild(a)}else console.log("options: unable to sort script at pos "+d.pos);else console.warn("options: something went wrong!",a)});f=(a=>{var b=a=>(b,c)=>b[a]-c[a];const c=a=>(b,c)=>pb.versionCmp(String(b[a]),String(c[a])),e=a=>(b,c)=>b[a]<c[a]?-1:b[a]>c[a]?1:0,f=(a,b)=>(c,d)=>{c=(b^c[a]?"a":"b")+c.name;d=(b^d[a]?"a":"b")+d.name;return c<d?-1:c>d?1:0},h=ea();"pos"==h?b=b("position"):"enabled"==h?(b=f("enabled",
d),d=null):b="ver"==h?c("version"):"updated"==h?b("updated"):e(h);a.sort(b);return a})(f);d&&(f=f.reverse());for(let a=0;a<m;a++)e.appendChild(f[a].tr);$(".sorting").each((a,b)=>{a=$(b);b="pos"==ea()&&"up"==ka();a[b?"fadeIn":"fadeOut"]()});a&&a()};Ba.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();const Da=(()=>{let a={};const b=a=>7>a.toString().length?b("0"+a):a,c=a=>{if(a.includes||a.matches){const b={},c=[],d=a.includes.length?a.includes:a.matches;for(let e=
0;e<d.length;e++){const f=d[e];if(!f){console.log("o: Warn: script '"+a.name+"' has invalid include (index: "+e+")");continue}const h=Ba.items.sites.get(f),l=void 0!==h?h:n.getInfoFromUrl(f);void 0===h&&Ba.items.sites.set(f,l);l&&l.dom?b[l.dom]||(b[l.dom]=!0,c.push({include:f,info:l})):c.push({include:f})}return c}};return{init:function(b){a={};b.forEach(b=>{(b=c(b))&&b.length&&b.forEach(b=>{b.info&&(a[b.info.dom]=(a[b.info.dom]||0)+1)})})},get:function(d){d=c(d);if(!d||!d.length)return b(0);d=w.map(d,
b=>b.info?{score:1E3*a[b.info.dom]+b.info.dom.charCodeAt(0)||0,dom:b.info.dom}:{score:0,dom:""}).sort((a,b)=>b.score-a.score)[0];return b(d.score)+d.dom},topIcons:function(b,d){let e;const f=[];var l=c(b);if(!l||!l.length)return[];l=w.map(l,b=>{b.score=b.info?a[b.info.dom]||0:0;return b}).sort((a,b)=>b.score-a.score);w.each(l,a=>{var c=a.info;if(0==d--)return a=g("span","",b.uuid,"tbc"),a.textContent="...",f.push(a),!1;if(c){if("*"==c.tld)return e=n.createIcon(C.get("web"),"web",b.uuid,a.include,
a.include),f.push(e),!1;var h="com",k="";"*"!=c.tld&&"tld"!=c.tld&&(h=c.tld);c.subdom.length&&(k=c.subdom.join(".")+".");h=(k+c.dom+"."+h).replace(/\*/g,"");k="http://"+h+"/";c=A.RUNTIME.CHROME?"chrome://favicon/"+k:null;h=0==k.search("http://userscripts.org/")||0==k.search("http://userscripts.com/")?C.origin("uso"):"native"==u.favicon_service?k+"favicon.ico":"duckduckgo"==u.favicon_service?"https://icons.duckduckgo.com/ip2/"+encodeURIComponent(h)+".ico":"https://www.google.com/s2/favicons?domain="+
encodeURIComponent(h);e=n.createFavicon([h,c,()=>C.get("question_mark")].filter(a=>a),"favicon",b.uuid,a.include,a.include)}else e=n.createIcon(C.get("question_mark"),"favicon",b.uuid,a.include,a.include);f.push(e)});return f}}})();let la=null;const P=()=>{la&&(window.clearTimeout(la),la=null)},Fa=a=>{let b;const c=a.key||"general";(b=Za[c])&&$(b).remove();Za[c]=n.createGobalHint(a,$("body > div.status")[0])},Ga=(a,b,c,e)=>{void 0===e&&(e=3E3);Fa({key:"success",text:a,image:b,class:c,delay:500,timeout:e,
done:function(){}})},U=()=>{Ga(c.getMessage("Operation_completed_successfully"),"button_ok","notice")},$a=(a,b)=>{void 0===b&&(b="button_ok");Ga(a,b,"information",8E3)},ab=(a,b)=>{void 0===b&&(b="error");Ga(a,b,"warning",8E3)},Q=a=>{la||(la=window.setTimeout(()=>{la=null;p.wait(c.getMessage("Please_wait___"))},a||500))};let sa=null,ma=null;const W=(a,b)=>{null!=sa?(window.clearTimeout(sa),sa=null,W(a?a:ma.items,a?b:ma.with_scripts)):(ma={items:a,with_scripts:b},sa=window.setTimeout(()=>{sa=null;ma.with_scripts&&
(Y={});xa(null,ma.items,null,I);p.hide();Ha();ma=null},50))},qb=a=>{const b=B();sendMessage({method:"determineScriptsToRun",url:a},a=>{b.resolve(a.scripts||[])});return b.promise()},ja=(a,b,c)=>{const d=B();sendMessage({method:"begEvent",action:a,type:b,extra:c},a=>{d.resolve(a)});return d.promise()},bb=(a,b)=>{const c=B();try{Q(),sendMessage({method:"installScript",url:a.url,code:a.code,reload:b.reload},a=>{P();a.items?(U(),W(a.items,!1)):p.hide();a.err?c.reject(a):c.resolve(a)})}catch(e){console.log("sS: "+
e.message),c.reject({err:e.message})}return c.promise()},rb=(a,b)=>{const c=B();try{Q(),sendMessage({method:"exportToJson",ids:a,options:b},a=>{U();P();p.hide();a.json?c.resolve(a.json):c.reject()})}catch(e){console.log("eJ: "+e.message),c.reject({})}return c.promise()},Ia=(a,b)=>{const c=B();try{Q(),sendMessage({method:"importFromJson",json:a,reload:b.reload},a=>{P();a.reload?window.setTimeout(()=>{rea.page.reload()},500):a.items?(U(),W(a.items,!0)):p.hide();a.err?c.reject(a):c.resolve(a)})}catch(e){console.log("sS: "+
e.message),c.reject({err:e.message})}return c.promise()},sb=(a,b,c)=>{const d=B();try{c.auto_save||Q(),sendMessage({method:"saveExternal",uuid:a,code:b,mimetype:c.mimetype,url:c.url,auto_save:c.auto_save},a=>{c.auto_save||(U(),P());a=a||{};a.items?W(a.items,!0):p.hide();d.resolve(a)})}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},Ja=(a,b,c)=>{const d=B();void 0===c.reload&&(c.reload=!0);try{c.auto_save||Q(),sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,
force:c.force,new_script:c.new_script,auto_save:c.auto_save,lastModTime:c.lastModTime,reload:c.reload},a=>{c.auto_save||(U(),P());a=a||{};a.items?W(a.items,!0):p.hide();!b&&c.reload&&p.hide();d.resolve(a)})}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},ya=(a,b,c)=>{const d=B();try{Q(),sendMessage({method:"setOption",name:a,value:b},a=>{P();U();u=a.options||u;!c&&a.items?W(a.items,!1):p.hide();d.resolve(a)})}catch(f){console.log("sO: "+f.message),d.reject({err:f.message})}return d.promise()},
tb=(a,b,c)=>{const d=B();try{Q(),sendMessage({method:"buttonPress",name:a,data:b},a=>{P();!c&&a.items?(U(),W(a.items,!1)):p.hide();d.resolve(a)})}catch(f){console.log("sO: "+f.message),d.reject({err:f.message})}return d.promise()},na=(a,b)=>{Q();sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,url:a.url,referrer:a.referrer,layout:a.layout,filter:a.filter},a=>{P();a.items||(a.error?alert(a.error):confirm(c.getOriginalMessage("An_internal_error_occured_Do_you_want_to_visit_the_forum_"))&&
(window.location.href="https://www.tampermonkey.net/bug"));b(a)})},ub=(a,b,c)=>{na({referrer:"options.scripts.userscripts.matches",uuid:a,filter:b},a=>{p.hide();c(a.items)})},cb=()=>{na({referrer:"options.scripts"},a=>{a.items?W(a.items,!0):p.hide()})},fa=(a,b,d)=>{void 0==d&&(d=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:d};for(const c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);Q();sendMessage(a,a=>{P();u=a.options||u;a.i18n&&c.setLocale(a.i18n);U();a.items?W(a.items,!0):p.hide()})}catch(e){console.log("mSo: "+
e.message)}},db=(a,b,c)=>{try{a={method:"saveStorageKey",uuid:a,key:b,value:c,id:"options"},Q(),sendMessage(a,()=>{P();U();p.hide()})}catch(e){console.log("sSk: "+e.message)}},eb=(a,b,c)=>{try{a={method:"download",details:{url:a,name:b,saveAs:!0},id:"options"},Q(),sendMessage(a,()=>{P();U();p.hide();c&&c()})}catch(e){console.log("dDU: "+e.message)}},vb=(a,b)=>{try{Q(),sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,safe_url:b},a=>{P();U();a.items?W(a.items,!1):p.hide()})}catch(d){console.log("dEx: "+
d.message)}},wb=(a,b)=>{try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},a=>{U();b&&b(a.updatable)})}catch(d){console.log("rSu: "+d.message)}},xb=(a,b,c)=>{try{sendMessage({method:"reportAnIssue",uuid:a,to:b},()=>{c&&c()})}catch(e){console.log("rRi: "+e.message)}},oa=window.navigator.userAgent.includes("Mac")?"mac":"other";window.addEventListener("keydown",a=>{let b=!1;if("keydown"==a.type&&!a.defaultPrevented){if(27==a.keyCode){var c=I.getTabById("dashboard");if(!c.isSelected())return;
if(a.target&&"text"==a.target.type){$(a.target).blur();return}v.multiselect.toggleRow(!1);b=!0}else if(("mac"!=oa&&39==a.keyCode||"mac"==oa&&40==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey){if(c=I.getNextTab())c.select(),b=!0}else("mac"!=oa&&37==a.keyCode||"mac"==oa&&38==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey&&(c=I.getPreviousTab())&&(c.select(),b=!0);if(b)return a.stopPropagation(),a.preventDefault(),!1}},!0);window.addEventListener("keydown",a=>{var b;let c=!1;if("keydown"==a.type&&!a.defaultPrevented){if(112==
a.keyCode)(b=I.getTabById("help"))&&b.select(),c=!0;else if((38==a.keyCode||40==a.keyCode)&&a.shiftKey){b=I.getTabById("dashboard");if(!b.isSelected())return;if((b=X.length&&X[X.length-1])&&(b=$(b))){c=!0;var e=b.closest("tr");if(e.length){if(38==a.keyCode){e=e.prevAll("tr:visible:first");var f=!0}else e=e.nextAll("tr:visible:first"),f=!1;if(e.length){var g=e.find('input[name="scriptselectors"]');if(X.includes(g[0])){X.pop();b.prop("checked",!1);b.removeClass("selected");var h=b}else g.length&&(g.prop("checked",
!0),g.addClass("selected"),X.push(g[0]),void 0===X.direction&&(X.direction=f),h=g);h&&(n.isScrolledIntoView(e,{padding:100})||$("html, body").animate({scrollTop:f?e.offset().top-100-e.height():e.offset().top-$(window).height()+100+2*e.height()},0),v.multiselect.single_click())}}}}else if(70==a.keyCode&&(a.ctrlKey||a.metaKey)){b=I.getTabById("dashboard");if(!b.isSelected())return;v.multiselect.toggleRow(!0,!0);c=!0}else if(65==a.keyCode&&(a.ctrlKey||a.metaKey)){b=I.getTabById("dashboard");if(!b.isSelected()||
a.target&&"text"==a.target.type)return;v.multiselect.un_selectAll(!0);c=!0}if(c)return a.stopPropagation(),a.preventDefault(),!1}},!1);let ba;const N=(()=>{const a={},b=()=>{ba=w.getUrlArgs(!0);Object.keys(a).forEach(b=>{b=a[b];f.is(b.main,b.sub)&&b.fn()})};b();let c;window.onhashchange=function(){c||b.apply(this,arguments)};const e=a=>{c=!0;a();c=!1},f={set:function(a){const c=f.get();let d;d="object"===typeof a?[a.main,a.sub].filter(a=>a):arguments;if(c.main!==d[0]||c.sub!==d[1])!d[0]&&d[1]?f.setSub(d[1]):
e(()=>{window.location.hash="nav="+Array.prototype.join.call(d,"+");b()})},setSub:function(a){const c=f.get();c.sub!==a&&e(()=>{window.location.hash="nav="+(c.main?c.main:"")+"+"+a;b()})},get:function(){const a=ba.nav?ba.nav.split("+"):[];return{main:a[0],sub:a[1]}},is:function(a,b){const c=f.get();b=!b||c.sub===b;return(!a||c.main===a)&&b},isSub:function(a){return f.is(null,a)},registerListener:function(b,c,d){void 0===d&&(d=c,c=null);const e=[b,c].join("+");a[e]={main:b,sub:c,fn:d};f.is(b,c)&&d();
return e},unregisterListener:function(b){delete a[b]},clear:function(){f.set("")}},g=f.get();J.push(()=>{var a=I.getTabById(g.main);if(a)return a.select(!0);if(g.main)(a=I.getTabById("dashboard"))&&a.select(!0),J.push(()=>{window.setTimeout(()=>{f.set(g)},1)});else window.onhashchange()});return f})();(()=>{J.push(()=>{u.statistics_enabled&&ob.init("opt",rea.extension.manifest.version,!0,!1,!0)})})();const Ka=w.getDebouncer(1E3),Ha=()=>{for(;J.length;)try{J.shift()()}catch(a){console.warn("doneListeners:",
a)}},yb=(a,b)=>{const d=y("input",a.name,a.id,"Save");d.inserted||(d.type="button",d.section=a,d.disabled=!0,d.value=c.getMessage("Save"),d.addEventListener("click",function(){if(!b||!b.warning||qa(b.warning)){var a=$(this.section).find("input, select, textarea").toArray(),d=[],g=[];for(let e=0;e<a.length;e++){let f=null;var h=a[e];const l=h.key;if(!g.includes(h)){if("textarea"==h.tagName.toLowerCase())if(h.named)h=document.getElementsByName(h.name),f=[],w.each(h,a=>{f.push({name:a.named_name,value:a.value});
g.push(a)});else if(h.array)f=h.value.split("\n").map(a=>a.trim()).filter(a=>a);else if(h.json){let a;try{f=(a=h.value)&&(a=a.trim())?JSON.parse(a):null}catch(q){w.alert(c.getMessage("Unable_to_parse_0name0",h.name));return}}else f=h.value;else if("checkbox"==h.getAttribute("type"))f=h.checked;else if("select"==h.getAttribute("type")){let a=0;0<=h.selectedIndex&&h.selectedIndex<h.options.length&&(a=h.selectedIndex);f=h[a]?h[a].value:h.options[0].value}else"button"!=h.getAttribute("type")&&(f=h.value);
l&&d.push(ya(l,f,b&&b.reload))}}b&&b.reload&&(p.wait(),B.when(d).done(()=>{rea.page.reload()}))}},!1));return d},Bb=(a,b)=>{var d=(a,b,c,d,e)=>{let f;const k=g("th","settingsth",a.name,a.id,b),h=(b,c,d)=>{b=document.getElementsByName("settingsth_a_up"+a.name);const e=document.getElementsByName("settingsth_a_down"+a.name);for(f=0;f<b.length;f++)b[f].style.display="none";for(f=0;f<e.length;f++)e[f].style.display="none";"up"==ka()?c.style.display="":d.style.display=""},l=g("a","settingsth_a",a.name,
a.id,b+"_a");l.setAttribute("name","settingsth_a"+a.name);const q=g("a","settingsth_a_up",a.name,a.id,b+"_a_up");q.setAttribute("name","settingsth_a_up"+a.name);const z=g("a","settingsth_a_down",a.name,a.id,b+"_a_down");z.setAttribute("name","settingsth_a_down"+a.name);b=()=>{h(l,q,z)};const m=()=>{h(l,q,z)},r=()=>{window.setTimeout(()=>{ea()==d?Xa("down"==ka()?"up":"down"):Wa(d);Ya(m)},1)};k.inserted||(k.appendChild(l),k.appendChild(z),k.appendChild(q),l.addEventListener("click",r),q.addEventListener("click",
r),z.addEventListener("click",r),l.textContent=c+" ",l.href="#",q.innerHTML="&#x25B4;",q.href="#",z.innerHTML="&#x25BE;",z.href="#");e&&!ea()?(Wa(d),Xa("up"),window.setTimeout(b,1)):d==ea()&&window.setTimeout(b,1);return k};let e,f,m;let h,l;h=y("tbody",a.name,a.id,"body");l=y("thead",a.name,a.id,"head");if(a.scriptTab){var k=zb(a),F=Ab(a);e=y("table",a.name,a.id,"main");e.inserted||e.setAttribute("class","scripttable multiselect");var r=g("th","script_sel",a.name,a.id,"thead_sel");r.appendChild(k.selAllm);
var q=g("th","left",a.name,a.id,"thead_multi_action");q.setAttribute("colspan",A.RUNTIME.MOBILE?3:11);q.appendChild(k.actionBox);q.appendChild(F);F=g("th","right",a.name,a.id,"thead_multi_close");F.appendChild(k.close);m=g("tr","multiselectrow",a.name,a.id,"filler_multi");m.appendChild([r,q,F]);r=g("tr","multiselectscrolldummy",a.name,a.id,"scrolldummy");q=g("th","left",a.name,a.id,"scrolldummyth");q.setAttribute("colspan",A.RUNTIME.MOBILE?3:11);r.appendChild([q]);f=g("tr","scripttr multiselectreplaced",
a.name,a.id,"filler");q=g("th","script_sel",a.name,a.id,"thead_sel");q.appendChild(k.selAll);k=d(a,"thead_pos","#","pos");F=d(a,"thead_en",c.getMessage("Enabled"),"enabled");const h=d(a,"thead_name",c.getMessage("Name"),"name",!0),n=g("th","settingsth",a.name,a.id,"thead_del");n.textContent=c.getMessage("Actions");if(A.RUNTIME.MOBILE)w.each([q,k,F,h,n],a=>{f.appendChild(a)});else{const b=d(a,"thead_ver",c.getMessage("Version"),"ver"),e=g("th","settingsth ",a.name,a.id,"thead_type");var t=g("span",
"script_type",a.name,a.id,"thead_type_span");t.textContent=c.getMessage("Type");e.appendChild(t);const l=g("th","settingsth",a.name,a.id,"thead_sync");l.textContent="";t=d(a,"thead_sites",c.getMessage("Sites"),"sites");t.width="25%";const m=g("th","settingsth",a.name,a.id,"thead_features");m.textContent=c.getMessage("Features");const r=d(a,"thead_homepage",c.getMessage("Homepage"),"homepage");d=d(a,"thead_updated",c.getMessage("Last_updated"),"updated");const x=g("th","settingsth",a.name,a.id,"thead_sort");
a=g("span","sorting",a.name,a.id,"thead_sort_span");a.textContent=c.getMessage("Sort");"pos"==ea()&&"up"==ka()||a.setAttribute("style","display: none;");x.appendChild(a);J.push(()=>{u.sync_enabled&&(l.textContent=c.getMessage("Imported"))});w.each([q,k,F,h,b,e,l,t,m,r,d,x,n],a=>{f.appendChild(a)})}l.appendChild([m,r,f]);f.inserted||(v.multiselect.checkScroll=()=>{const a=$(l),c=a.is(":visible")&&$(m).is(":visible")&&0<$(b).scrollTop();a.toggleClass("multiscrolling",c)},$(b).scroll(v.multiselect.checkScroll))}else e=
g("table","settingstable",a.name,a.id,"main");e.appendChild(l);e.appendChild(h);return{table:e,head:l,body:h}},gb=(a,b,c,e)=>{let d,m;let h=[];var l=(a,b)=>{if(c)if(c.save_button)$(a).on("change",()=>{c.save_button.disabled=!1}),$(b).on("input propertychange",()=>{c.save_button.disabled=!1});else if(console.error("Section needs a save button!",c),Registry.isDevVersion("layout/default/layout_helper"))throw Error("Section needs a save button!");};if(b.divider)return null;b.image&&(b.image_id=C.get(b.image));
if(b.checkbox){var k=function(){let a=!0;const b=this;b.warning&&(a=qa(b.warning),a||(b.checked=!b.checked));a&&ya(this.key,b.checked,b.reload).always(()=>{b.reload&&rea.page.reload(500)})};c&&c.need_save&&(k=m=null);d=n.createCheckbox(b.name,b,k);h.push(d.elem);c&&c.save_button&&l(null,d.input)}else if(b.button)k=function(){let a=!0;const b=this;b.warning&&(a=qa(b.warning));a&&tb(b.key,b.data,b.ignore).always(()=>{b.reload&&rea.page.reload(500)})},d=n.createButton(b.name,b,k),h.push(d);else if(b.named)d=
n.createNamedSettings(b.name,b),h.push({element:d.elem,validation:d.label}),l(null,d.textareas);else if(b.input)d=n.createTextarea(b.name,b),h.push({element:d.elem,validation:d.label}),l(null,d.textarea);else if(b.text)d=n.createInput(b.name,b),h.push(d.elem),l(d.input);else if(b.color)d=n.createColorChooser(b.name,b),h.push(d.elem),l(d.input);else if(b.password)d=n.createPassword(b.name,b),h.push(d.elem),l(d.input);else if(b.select)m=function(){let a=!0;const b=this;b.warning&&(a=qa(b.warning),a||
(b.value=b.oldvalue));a&&ya(b.key,n.getValue(b),b.reload).always(()=>{b.reload&&rea.page.reload(500)})},c&&c.need_save&&(m=b.enabler?function(){const a=document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};w.each(a,a=>{void 0===c[a.key]||c[a.key]?a.setAttribute("style",w.staticVars.visible):a.setAttribute("style",w.staticVars.invisible)})}:null),d=n.createDropDown(b.name,
b,b.select,m,function(){let a;this.selectedOptions.length&&this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(a=qa(this.selectedOptions[0].warning),a||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value}),h.push(d.elem),c&&c.save_button&&l(d.select),a&&b.enabler&&(()=>{const a=m,b=d;J.push(()=>{a.apply(b.select,[])})})();else if(b.url)k=y("a",b.name,b.id),k.href="#",k.url=b.url,k.newtab=b.newtab,k.inserted||(m=function(){wa(this.url,this.newtab)},
k.addEventListener("click",m)),k.textContent=b.name,h=Array(13),h[3]=k;else if(b.main_menu_item){k=y("div",b.name,b.id);k.textContent=b.name;l=y("div",b.name,b.id,"tab_content");var F=Bb(b,l);l.appendChild(F.table);let d=null;const f=e.appendTab(b.id,k,l,a=>{a.then(()=>{d&&(va.global?d():J.push(d));N.set(b.id);document.title=b.name})});N.registerListener(b.id,()=>{f.select()});b.referrer&&(d=()=>{d=null;Q(50);na({referrer:b.referrer},b=>{b.items&&b.items.forEach(b=>{gb(a,b,c,e)});Ha();P();p.hide()})});
b.items&&xa(F.body,b.items,null,e);!va.global&&b.selected_default&&J.push(()=>{e.getSelectedTab()||f.select()})}else b.sub_menu_item?(l=g("div","section type_"+b.id,b.name,b.id,"section"),k=g("div","section_head",b.name,b.id,"head"),F=g("table","section_content",b.name,b.id,"content"),k.textContent=b.name,l.appendChild(k),b.desc&&n.setHelp(b.desc,k,k,b),l.appendChild(F),b.need_save&&(b.save_button=yb(F,b)),xa(F,b.items,b,e),b.save_button&&F.appendChild(b.save_button),h.push(l)):b.userscript?(h=Cb(b,
a,e),b.userscript&&(Y[b.uuid]={dom:a,script:b}),a.setAttribute("class","scripttr"),b.nnew?a.setAttribute("style","display: none;"):Ka.is("script_refresh")||(J.push(()=>{Da.init(w.map(Y,a=>a.script));v.multiselect.single_click();Ya();va.scripts=!0;Ka.clear()}),Ka.add("script_refresh"))):b.globalhint?Fa(w.copy(b.options,{onclick:b.options.info_url?()=>{wa(b.options.info_url,!0)}:null})):(k=y("span","",b.uuid||b.id+b.name),k.textContent=b.name,h=Array(13),h[3]=k);h.forEach(a=>{if(a){void 0!==b.level&&
(a.element||a).setAttribute("style",b.level>u.configMode?w.staticVars.invisible:w.staticVars.visible||"");if(b.hint){const c=y("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&Db(b,a.validation||a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(F=a.getAttribute("class"),k=" hide",!1===b.visible?F=(F||"")+k:F&&(F=F.replace(k,"")),a.setAttribute("class",F));return h},xa=(a,b,c,e)=>{Object.keys(b).forEach(d=>{const f=b[d],h=a?g("tr","settingstr",
f.uuid||f.id+f.name,"pi"):null;(d=gb(h,f,c,e))&&d.length&&(a&&a.appendChild(h),w.each(d,(a,b)=>{let c=a,d="";"Object"===w.toType(a)&&(c=a.element,d=a.style||"");b=g("td",d+" settingstd","",f.uuid||f.id+f.name,b);a&&b.appendChild(c);h&&h.appendChild(b)}))})},Db=(a,b)=>{var c;a.validation&&(a.validation.url&&(c=function(){wa(this.url,!0)}),c=n.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:void 0,b.appendChild(c))},Eb=a=>{const b=a=>a.url?{meta:{name:ua.parse(a.url).pathname.split("/").pop(),
url:a.url,sri:a.sri,ts:a.ts,mimetype:a.mimetype,modified:a.modified},source:a.data.content}:void 0,c=a=>a;return{source:a.code,meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position},resources:a.resources?a.resources.map(b).filter(c):[],requires:a.requires?a.requires.map(b).filter(c):[]}},La=a=>{const b=a.meta||{},c=a.settings||{},e=a=>({url:a.meta.url,sri:a.meta.sri,
ts:a.meta.ts,mimetype:a.meta.mimetype,modified:a.meta.modified,content:a.source});return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:c.enabled,position:c.position,resources:a.resources?a.resources.map(e):[],requires:a.requires?a.requires.map(e):[]}},za=(a,b)=>{const c=B(),e=[];rb(a,b).done(a=>{a.scripts.forEach(a=>{a.uuid&&a.userscript&&!a.system&&!a.nnew&&(a.code&&""!=a.code.trim()?e.push(Eb(a)):console.log("options: Strange script: "+
a.name))});c.resolve({scripts:e,global_settings:a.global_settings})}).fail(()=>{c.reject()});return c.promise()},Fb=a=>{let b,d;const e=y("div","help","help","tab_help_h"),f=e.textContent=c.getMessage("Help"),m=y("div","help","help","tab_help");return a.appendTab("help",e,m,a=>{a.then(()=>{N.set("help");document.title=f;if(!d){p.wait();const e=g("div","section","help","help","ta");var a=g("div","section_head","help","help","head_ta");const f=g("div","section_content","help","help","content_ta");a.textContent=
c.getMessage("Editor");e.appendChild([a,f]);const h=g("dl","dl-horizontal shortcuts","help","help","dl");f.appendChild(h);a=g("dt","keymapping","help","help","dt_mapping");b=g("dd","keymapping","help","help","dd_mapping");a.textContent=c.getMessage("Key_Mapping");b.textContent=u.editor_keyMap;h.appendChild([a,b]);if("vim"==u.editor_keyMap)b=g("dd","keymapping","help","help","dd_unsup"),b.textContent=c.getMessage("Please_check_the_0editor0_documentation_for_more_details_","VIM"),h.appendChild(b);else if("emacs"==
u.editor_keyMap)b=g("dd","keymapping","help","help","dd_unsup"),b.textContent=c.getMessage("Please_check_the_0editor0_documentation_for_more_details_","Emacs"),h.appendChild(b);else{const a=[];d={};const b=a=>{a=a.split(/-+/);const b=a.pop(),c=[];let d;-1!=(d=["up","down","left","right"].indexOf(b.toLowerCase()))&&c.push("#cursor");b.toLowerCase().match(/f[0-9]{1,2}/)&&c.push("#function");return c.length?c.join("-")+a.join("-")+d+b:("0000"+(100-Math.min(b.length,4))).slice(-4)+b+a.join("-")};[w.assign({Esc:"backOrClose"},
"mac"!=oa?{"Alt-Left":"previousTab","Alt-Right":"nextTab"}:{"Alt-Up":"previousTab","Alt-Down":"nextTab"}),CodeMirror.keyMap[u.editor_keyMap],"mac"!=oa?CodeMirror.keyMap.pcDefault:CodeMirror.keyMap.macDefault,CodeMirror.keyMap["default"]].forEach(c=>{Object.keys(c).forEach(e=>{d[e]||"fallthrough"==e||(a.push({name:e,fn:c[e].replace?c[e].replace(/([A-Z])/g," $1").replace(/ [A-Z]/g,a=>a.toLowerCase()):c[e],sort:b(e)}),d[e]=!0)})});a.sort((a,b)=>a.sort<b.sort?-1:a.sort>b.sort?1:0);a.forEach(a=>{const b=
y("dt","help","help","dt_"+a.sort),c=y("dd","help","help","dd_"+a.sort);b.textContent=a.name;c.textContent=a.fn;h.appendChild([b,c])})}m.appendChild(e);p.hide()}})})};let ta=()=>{if(A.RUNTIME.FIREFOX)return window.saveAs=(a,b)=>{const c=URL.createObjectURL(a);eb(c,b,()=>{URL.revokeObjectURL(c)})},B.Pledge();if(A.RUNTIME.SAFARI)return window.saveAs=(a,b)=>{ia.blob2str(a,a=>{a="data:application/octet-stream;base64,"+ia.Base64.encode(a);eb(a,b)})},B.Pledge();if(A.RUNTIME.EDGE&&window.navigator&&window.navigator.msSaveBlob)return window.saveAs=
(a,b)=>{window.navigator.msSaveBlob(a,b)},B.Pledge();{const a=B();Registry.vendor(["vendor/saveas/filesaver"],()=>{ta=B.Pledge;a.resolve()});return a.promise()}};const Hb=a=>{const b={name:"utils",id:"utils"};var d=y("div",b.name,b.id,"tab_util_h");const e=d.textContent=c.getMessage("Utilities"),f=y("div",b.name,b.id,"tab_util");a.appendTab(b.id,d,f,a=>{a.then(()=>{N.set(b.id);document.title=e})}).show();a=g("div","tv_util",b.name,b.id,"tab_util_cont");let m=()=>{Ra.init(a=>{let b=B();const c=rea.extension.connect("tabWatch");
c.onMessage.addListener(a=>{b&&((a=a.tab)?b.notify(a):(b.resolve(),b=null,c.disconnect()))});c.onDisconnect.addListener(()=>{b&&b.resolve()});c.postMessage({method:"tabWatch",url:a.url});return{promise:b.promise(),close:function(){b&&b.resolve();c.disconnect()}}});m=null},h={};const l=a=>{let b,c;b="webdav"==a&&(c=D.cloud_config)?{url:c.url,basic_auth:ia.Base64.encode(c.user+":"+c.pass)}:{};return h[a]=h[a]||Ra[a](b)},k=()=>za(null,{storage:D.script_storage,global_settings:D.add_tm_settings,externals:D.include_externals}).then(a=>
{p.wait();return da.zip.create(a.scripts,a.global_settings).progress(p.wait)}),F=a=>{const b=B(),c=new FileReader;c.onload=a=>{b.resolve(a.target.result)};c.readAsText(a);return b.promise()},r=a=>{for(let b=0,d;d=a[b];b++)da.zip.read(d).progress(p.wait).then(a=>Ia({scripts:w.map(a.scripts,a=>La(a)),global_settings:a.global_settings},{reload:!0})).done(a=>{a.err&&w.alert(a.err)}).fail(()=>{w.alert(c.getMessage("Unable_to_parse_this_"))}).always(p.hide)};var q=n.createButton(b.name,b.id+"_i_ta",c.getMessage("Import"),
()=>{da.json.read(E.value).then(a=>Ia({scripts:w.map(a.scripts,a=>La(a)),global_settings:a.global_settings},{reload:!0})).done(a=>{a.err&&w.alert(a.err)}).fail(()=>{w.alert(c.getMessage("Unable_to_parse_this_"))})}),t=n.createFileSelect(c.getMessage("Import"),{name:"zip",id:b.id},a=>{p.wait();return r(a)}),x=n.createFileSelect(c.getMessage("Import"),{name:"file",id:b.id},a=>{p.wait();for(let b,d=0;b=a[d];d++)F(b).then(a=>da.json.read(a).then(a=>Ia({scripts:w.map(a.scripts,a=>La(a)),global_settings:a.global_settings},
{reload:!0}),function(){return bb({code:a},{reload:!0})})).done(a=>{a.err&&w.alert(a.err)}).fail(()=>{w.alert(c.getMessage("Unable_to_parse_this_"))}).always(p.hide)}),ra=n.createButton(b.name,b.id+"_i_cloud",c.getMessage("Show_backups"),()=>{p.wait();const a=T.select.value,b=T.select.selectedOptions[0].text;m&&m();l(a).list().progress(a=>{0<a.total&&p.wait(b+": "+Math.floor(a.loaded/a.total*100)+"%")}).then(a=>{a=a.filter(a=>a.name.match(/\.zip$/));return a.length?a:B.Breach("empty")}).then(b=>{const d=
B(),e=$('<table class="nowrap file_select">');$('<thead><tr><th colspan="3">'+c.getMessage("Please_select_a_file")+":</th></tr></thead>").appendTo(e);b.sort((a,b)=>a.modified-b.modified).forEach(b=>{const f=$('<input class="button" type="button" value="'+c.getMessage("Import")+'">').click(()=>{d.resolve(b);p.hideDialog();p.wait()}),h=$('<input class="button" type="button" value="'+c.getMessage("Delete")+'">').click(()=>{k.hide();l(a).delete(b)}),k=$("<tr><td>"+[n.safeTagsReplace(b.name),pa.formatBytes(b.size,
2),(new Date(b.modified)).toLocaleString().replace((new Date).toLocaleDateString(),c.getMessage("Today"))].join("</td><td>")+"</td></tr>");$("<td>").append(f,h).appendTo(k);k.appendTo(e)});b=$('<input class="button" type="button" value="'+c.getMessage("Cancel")+'">').click(()=>{d.reject("cancel");p.hideDialog()});$("<tfoot>").append($("<tr>").append($('<td colspan="3">').append(b))).appendTo(e);p.hide();p.dialog(e[0]);return d.promise()}).then(c=>l(a).get(c).progress(a=>{0<a.total&&p.wait(b+": "+
Math.floor(a.loaded/a.total*100)+"%")})).then(a=>r([a])).fail(a=>{let b;"empty"===a?b=c.getMessage("No_backups_found"):"cancel"!=a&&("auth_failed"==a?console.warn("cloud: Authentication failed"):b=c.getMessage("Error")+": "+(a||c.getMessage("Action_failed")));b&&w.alert(b);p.hide()})});d=n.createButton(b.name,b.id+"_i_url",c.getMessage("Install"),()=>{p.wait();return bb({url:Aa.value},{reload:!0}).fail(a=>{a=a.err?a.err:c.getMessage("Unable_to_parse_this_");w.alert(a)}).always(p.hide)});var z=n.createButton(b.name,
b.id+"_e_ta",c.getMessage("Export"),()=>{p.wait();za(null,{storage:D.script_storage,global_settings:D.add_tm_settings,externals:D.include_externals}).then(a=>da.json.create(a.scripts,a.global_settings)).done(a=>{E.value=a}).always(p.hide)}),K=n.createButton(b.name,b.id+"_e_file",c.getMessage("Export"),()=>{p.wait();za(null,{storage:D.script_storage,global_settings:D.add_tm_settings,externals:D.include_externals}).then(a=>da.json.create(a.scripts,a.global_settings).then(a=>ta().done(()=>{const b=new Blob([a],
{type:"text/plain"});saveAs(b,w.safeFileName("tampermonkey-backup-"+A.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".txt"))}))).always(p.hide)}),G=n.createButton(b.name,b.id+"_e_zip",c.getMessage("Export"),()=>k().then(a=>ta().done(()=>{saveAs(a,w.safeFileName("tampermonkey-backup-"+A.RUNTIME.BROWSER+"-"+(new Date).toISOString()+".zip"))})).always(p.hide)),v=n.createButton(b.name,b.id+"_e_zip",c.getMessage("Export"),()=>{const a=B(),b=T.select.value,d=T.select.selectedOptions[0].text,e=a=>k().then(c=>
{p.wait(d+"...");m&&m();return l(b).put(a+".zip",c).progress(a=>{0<a.total&&p.wait(d+":"+Math.floor(a.loaded/a.total*100)+"%")})}).fail(a=>{w.alert(c.getMessage("Error")+": "+(a||c.getMessage("Action_failed")))}).always(p.hide);w.prompt(c.getMessage("Name"),"backup-"+A.RUNTIME.BROWSER+"-"+(new Date).toISOString(),b=>{b?a.consume(e(b)):a.reject("aborted")});return a.promise()}),R=n.createCheckbox(c.getMessage("Include_TM_settings"),{id:b.id+"_e_export_tm_settings",enabled:"true"},function(){D.add_tm_settings=
this.checked;A.HTML5.LOCALSTORAGE&&A.HTML5.LOCALSTORAGE.setItem("export_tm_settings",D.add_tm_settings)});R.elem.setAttribute("style","padding-left: 2px");R.input.checked=D.add_tm_settings;var M=n.createCheckbox(c.getMessage("Include_script_storage"),{id:b.id+"_e_export_storage",enabled:"true"},function(){D.script_storage=this.checked;A.HTML5.LOCALSTORAGE&&A.HTML5.LOCALSTORAGE.setItem("export_script_storage",D.script_storage)});M.elem.setAttribute("style","padding-left: 2px; display: inline");M.input.checked=
D.script_storage;var H=n.createCheckbox(c.getMessage("Include_script_externals"),{id:b.id+"_e_export_externals",enabled:"true"},function(){D.include_externals=this.checked;A.HTML5.LOCALSTORAGE&&A.HTML5.LOCALSTORAGE.setItem("export_externals",D.include_externals)});H.elem.setAttribute("style","padding-left: 2px");H.input.checked=D.include_externals;var E=g("textarea","importta",b.name,b.id,"ta");E.setAttribute("spellcheck","false");const C=g("div","section",b.name,b.id,"ta");var L=g("div","section_head",
b.name,b.id,"head_ta");const V=g("div","section_content",b.name,b.id,"content_ta");L.textContent=c.getMessage("General");V.appendChild(M.elem);V.appendChild(R.elem);V.appendChild(H.elem);C.appendChild(L);C.appendChild(V);R=g("div","section",b.name,b.id,"ta");M=g("div","section_head",b.name,b.id,"head_ta");H=g("div","section_content",b.name,b.id,"content_ta");M.textContent=c.getMessage("TextArea");H.appendChild(z);H.appendChild(q);H.appendChild(E);R.appendChild(M);R.appendChild(H);q=g("div","section",
b.name,b.id,"sb");z=g("div","section_head",b.name,b.id,"head_sb");M=g("div","section_content",b.name,b.id,"content_sb");z.textContent=c.getMessage("Zip");q.appendChild(z);q.appendChild(M);M.appendChild(G);M.appendChild(t.elem);t=g("div","section",b.name,b.id,"sb");G=g("div","section_head",b.name,b.id,"head_sb");z=g("div","section_content",b.name,b.id,"content_sb");const S=function(){$(fb).toggle("webdav"===this.value);const a=l(this.value);$(ca).toggle(a&&!!a.revoke)};var T=n.createDropDown(c.getMessage("Type"),
{id:"cloud_type",value:"edge"==A.RUNTIME.BROWSER?"onedrive":"drive"},[{name:c.getMessage("Google_Drive"),value:"drive"},"safari"==A.RUNTIME.BROWSER?null:{name:c.getMessage("Dropbox"),value:"dropbox"},{name:c.getMessage("OneDrive"),value:"onedrive"},"safari"==A.RUNTIME.BROWSER?null:{name:c.getMessage("Yandex_Disk"),value:"yandex"},"safari"==A.RUNTIME.BROWSER?null:{name:c.getMessage("WebDAV"),value:"webdav"}].filter(a=>a),S);L=a=>()=>{h={};let b;(D.cloud_config=D.cloud_config||{})[a]=this.value;(b=
A.HTML5.LOCALSTORAGE)&&b.setItem("cloud_config",ia.Base64.encode(JSON.stringify(D.cloud_config)))};M=n.createInput(c.getMessage("URL"),{id:"select_cloud_url",uuid:b.uuid,value:(D.cloud_config?D.cloud_config.url:null)||""},L("url"));H=n.createInput(c.getMessage("Login"),{id:"select_cloud_username",uuid:b.uuid,value:(D.cloud_config?D.cloud_config.user:null)||""},L("user"));L=n.createInput(c.getMessage("Password"),{id:"select_cloud_password",uuid:b.uuid,password:!0,value:(D.cloud_config?D.cloud_config.pass:
null)||""},L("pass"));const fb=[M.elem,H.elem,L.elem];J.push(()=>{S.apply(T.select,[])});G.textContent=c.getMessage("Cloud");t.appendChild(G);t.appendChild(z);z.appendChild([T.elem].concat(fb));z.appendChild(v);z.appendChild(ra);const ca=n.createButton("revoke_token_button",b.uuid,c.getMessage("Revoke_Access_Token"),()=>{$(ca).prop("disabled",!0);l(T.select.value).revoke().always(()=>{$(ca).prop("disabled",!1)})});z.appendChild(ca);ra=g("div","section",b.name,b.id,"fi");v=g("div","section_head",b.name,
b.id,"head_fi");G=g("div","section_content",b.name,b.id,"content_fi");v.textContent=c.getMessage("File");ra.appendChild(v);ra.appendChild(G);G.appendChild(K);G.appendChild(x.elem);const Aa=g("input","updateurl_input",b.name,b.id,"url");Aa.setAttribute("type","text");Aa.setAttribute("spellcheck","false");x=g("div","section",b.name,b.id,"ur");K=g("div","section_head",b.name,b.id,"head_ur");v=g("div","section_content",b.name,b.id,"content_ur");K.textContent=c.getMessage("Install_from_URL");x.appendChild(K);
x.appendChild(v);v.appendChild(Aa);v.appendChild(d);a.appendChild(C);"undefined"!==typeof Blob&&a.appendChild(t);A.RUNTIME.CAN_SAVEAS_ZIP&&a.appendChild(q);"undefined"!==typeof Blob&&a.appendChild(ra);a.appendChild(R);a.appendChild(x);w.each([R],a=>{let b=a.getAttribute("class");b=50>u.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});f.appendChild(a)},Ib=()=>{const a=g("div","content_wrapper","options","main");var b=g("div","status","options","status");$(document.body).append(a,
b).addClass("main");b=g("div","head_container","opt","head_container");const d=g("div","tv_container_fit","opt","tv_container"),e=y("a","head_link","heads","head_link");e.href="https://www.tampermonkey.net";e.target="_blank";const f=g("div","float","heads","head1"),m=g("img","banner","heads");m.src=C.brand("tampermonkey");const h=g("div","float head","heads","head2"),l=g("div","header_title","heads"),k=g("div","version","version","version");k.textContent=" by Jan Biniok";const n=y("div","search",
"box",""),r=g("div","footer","footer");l.innerHTML="Tampermonkey<sup>\u00ae</sup>";f.appendChild(m);h.appendChild(l);h.appendChild(k);e.appendChild(f);e.appendChild(h);b.appendChild(e);b.appendChild(n);a.appendChild(b);a.appendChild(d);window.tab_view=I=Na.create("_main",d);I.setFooter(r);J.unshift(()=>{Hb(I);Fb(I)});J.push(()=>{void 0!==ba.contribute&&window.setTimeout(()=>{Va("f")},100);va.global=!0});window.onbeforeunload=a=>{let b;I.getAllTabs().forEach(a=>{b=b||a.modified()});return b?c.getMessage("There_are_unsaved_changed_"):
void 0}},Z=(a,b,d,e)=>{void 0===e&&(e={});const f=b.item,m=f.uuid+(e.orig||"")+b.id;var h=(e.orig?"orig_":"use_")+b.id;const l=a=>"select_"+w.createUniqueId(a,f.uuid)+"_sel1",k=g("div","cludes",a,m,"cb1");var F=y("span",a,m,"cb2");if(e.orig){var r="merge_"+b.id;r=n.createCheckbox(a,{id:r,uuid:f.uuid,enabled:f.options&&f.options.override&&f.options.override[r]?!0:!1},function(){if("checkbox"==this.type){const a={};a[this.key]=this.checked;fa(this.uuid,a)}});F.appendChild(r.elem)}else F.textContent=
a;const q=g("select","cludes",h,f.uuid,"sel1");q.innerHTML="";q.setAttribute("size","6");q.setAttribute("multiple","true");for(h=0;h<d.length;h++)r=document.createElement("option"),r.value=r.text=d[h],q.appendChild(r);k.appendChild(F);f.desc&&n.setHelp(f.desc,k,F,f);k.appendChild(q);const t=a=>{const b=[];a=a&&a.options;for(let c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b};h=()=>{var a=l("use_"+("excludes"==b.id?"includes":"excludes"));const c=document.getElementById(a);a=t(q);let d=
!1;const e="matches"==b.id;a.forEach(a=>{const b=e?"/"+ua.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),e&&(a.value=b,a.textContent=b),c.appendChild(a),d=!0)});d&&p()};r=()=>{const a=prompt(c.getMessage("Enter_the_new_rule"));if(a){const b=document.createElement("option");b.value=b.text=a.trim();q.appendChild(b);p()}};F=()=>{const a=q.options[q.selectedIndex];if(a){var b=prompt(c.getMessage("Enter_the_new_rule"),a.value);b&&(a.value=a.text=
b.trim(),p())}};d=()=>{let a=!1;t(q).forEach(b=>{b&&(b.parentNode.removeChild(b),a=!0)});a&&p()};const x=a=>{const b=[];for(let c=0;c<a.options.length;c++)b.push(a.options[c].value);return b};var p=()=>{const a={includes:x(document.getElementById(l("use_includes"))),matches:x(document.getElementById(l("use_matches"))),excludes:x(document.getElementById(l("use_excludes"))),connects:x(document.getElementById(l("use_connects"))),temp_connects:x(document.getElementById(l("use_temp_connects"))),blockers:x(document.getElementById(l("use_blockers")))};
fa(f.uuid,a);return!0};e.other_name?(a=y("button",a,m,"btn1",!0),a.textContent=c.getMessage("Add_as_0clude0",e.other_name),a.addEventListener("click",h,!1),k.appendChild(a)):e.orig||(e=y("button",a,m,"btn2",!0),e.textContent=c.getMessage("Add")+"...",e.addEventListener("click",r,!1),k.appendChild(e),e=y("button",a,m,"btn3",!0),e.textContent=c.getMessage("Edit")+"...",e.addEventListener("click",F,!1),k.appendChild(e),a=y("button",a,m,"btn4",!0),a.textContent=c.getMessage("Remove"),a.addEventListener("click",
d,!1),k.appendChild(a));return{elem:k}},Ea=a=>a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?a.namespace:null,Mb=(a,b,d,e,f)=>{d=y("div",b.uuid,"script_tab_head");const m=d.inserted,h=g("table","noborder p100100 heading",b.uuid,"h_table");var l=g("tr","",b.uuid,"h_tr1"),k=g("td","nameNicon64",b.uuid,"h_td1"),n=g("td","",b.uuid,"h_td2");h.appendChild(l);l.appendChild(k);l.appendChild(n);n.setAttribute("style","width: 99%");l=y("img",b.uuid,"heading_icon");var r=b.icon64?b.icon64:
b.icon;l.src=r;var q=g("div","nameNname64",b.uuid,"heading_name");q.textContent=c.getTranslation(b,"name");r&&k.appendChild(l);n.appendChild(q);k=g("div","author",b.uuid,"author");b.author?k.textContent="by "+b.author:b.copyright&&(k.innerHTML="&copy; ",k.textContent+=b.copyright);n.appendChild(k);n=g("table","noborder p100100",b.uuid,"table");k=g("tr","script_tab_head",b.uuid,"tr1");l=g("tr","details",b.uuid,"tr2");r=g("td","",b.uuid,"td1");q=g("td","",b.uuid,"td2");d.appendChild(h);r.appendChild(d);
k.appendChild(r);l.appendChild(q);n.appendChild(k);n.appendChild(l);e.appendChild(n);const t=Na.create("_details"+b.uuid,q,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",
tv_tab_close:"tv_tab_close",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"},!0),x=jb(b,t,{do_close:f,set_tab_class:(b,c)=>{a.toggleClass(b,c)},navid:"editor",treeid:"source"}),p=b.nnew||b.system?{}:Jb(b,t),z=b.nnew||b.system||!b.storage_key_count||80>u.configMode?{}:Kb(b,t),K=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Lb(b,t);if(m)return aa["tab"+b.uuid];const G=()=>{let a;return(a=t.getSelectedTab())&&a.isCloseable()?K.getEditor():x.getEditor()},v=b=>{let c=!1;
if("keydown"==b.type&&a.isSelected()&&!b.defaultPrevented){if(27==b.keyCode){if(!u.editor_enabled||"vim"!=u.editor_keyMap){var d;(d=t.getSelectedTab())&&d.isCloseable()?d.close():window.setTimeout(f,1);c=!0}}else if(u.editor_enabled){const a={save:!0,find:!0,findNext:!0,findPrev:!0,replace:!0,replaceAll:!0},e=G();d=CodeMirror.keyName(b);e&&!e.hasFocus()&&"handled"==CodeMirror.lookupKey(d,e.getOption("keyMap"),b=>{if(a[b])return e.execCommand(b),!0})&&(c=!0)}else 83==b.keyCode&&(b.ctrlKey||b.metaKey)&&
(d=G())&&(d.save(),c=!0);if(c)return b.stopPropagation(),b.preventDefault(),!1}};e={onShow:()=>{w.each([p,x,z,K],a=>{if(a.onShow)a.onShow()});window.addEventListener("keydown",v,!1)},onClose:a=>{let b;w.each([p,x,z,K],c=>{if(c.onClose&&c.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",v,!1);return b},onSelect:a=>{a.then(()=>{if(b.uuid){const a=N.get().sub,d=t.getTabById(a);N.set(b.uuid,(d?a:null)||"editor");document.title=c.getTranslation(b,"name")}});w.each([p,x,K],b=>{if(b.onSelect)b.onSelect(a)})}};
return aa["tab"+b.uuid]=e},Jb=(a,b)=>{const d=y("div",a.uuid,"script_setting_h"),e=y("div",a.uuid,"script_settings_c");d.textContent=c.getMessage("Settings");const f=function(){const a={};if("checkbox"==this.type)a[this.key]=!!this.checked,fa(this.uuid,a);else if("button"==this.type)a[this.key]=!this.oldvalue,fa(this.uuid,a);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){const b=n.getValue(this);a[this.key]=b;fa(this.uuid,a)}};var m=n.createCheckbox(c.getMessage("Enabled"),
{id:"enabled",uuid:a.uuid,name:"upd",enabled:a.enabled},f).elem;const h=n.createPosition(c.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:"pos",pos:a.position,posof:a.positionof},f),l=n.createDropDown(c.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:"run-at",value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:"document-idle",value:"document-idle"},{name:"context-menu",value:"context-menu"},
{name:c.getMessage("Default"),value:null}],f),k=n.createDropDown(c.getMessage("No_frames"),{id:"noframes",uuid:a.uuid,name:"no_frames",value:a.noframes},[{name:c.getMessage("Yes"),value:!0},{name:c.getMessage("No"),value:!1},{name:c.getMessage("Default"),value:null}],f),F=n.createCheckbox(c.getMessage("Check_for_Updates"),{id:"check_for_updates",uuid:a.uuid,name:"upd",enabled:a.check_for_updates}),r=n.createInput(c.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,name:"uu",value:a.file_url});
r.input.setAttribute("class","updateurl_input");r.elem.setAttribute("class","updateurl");a.is_external&&r.input.setAttribute("readonly","true");var q=b=>(a.options&&a.options.override?a.options.override[b]:null)||[],t=Z(c.getMessage("Original_includes"),{id:"includes",item:a},q("orig_includes"),{orig:!0,other_name:c.getMessage("User_excludes")}),x=Z(c.getMessage("Original_matches"),{id:"matches",item:a},q("orig_matches"),{orig:!0,other_name:c.getMessage("User_excludes")}),p=Z(c.getMessage("Original_excludes"),
{id:"excludes",item:a},q("orig_excludes"),{orig:!0,other_name:c.getMessage("User_includes")}),z=g("div","clear",a.uuid,"clear");const K=Z(c.getMessage("User_includes"),{id:"includes",item:a},q("use_includes")),G=Z(c.getMessage("User_matches"),{id:"matches",item:a},q("use_matches")),v=Z(c.getMessage("User_excludes"),{id:"excludes",item:a},q("use_excludes")),w=Z(c.getMessage("Original_domain_whitelist"),{id:"connects",item:a},a.connects,{orig:!0}),u=Z(c.getMessage("Temporary_domain_whitelist"),{id:"temp_connects",
item:a},a.temp_connects),C=Z(c.getMessage("User_domain_whitelist"),{id:"connects",item:a},q("use_connects"));q=Z(c.getMessage("User_domain_blacklist"),{id:"blockers",item:a},q("use_blockers"));var E=n.createCheckbox(c.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:"",enabled:a.compatopts_for_requires},f),A=n.createCheckbox(c.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:"",enabled:a.compat_wrappedjsobject},
f),L=n.createCheckbox(c.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),{id:"compat_metadata",uuid:a.uuid,name:"",enabled:a.compat_metadata},f),V=n.createCheckbox(c.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:"",enabled:a.compat_foreach},f),S=n.createCheckbox(c.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:"",enabled:a.compat_forvarin},f),T=n.createCheckbox(c.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",
uuid:a.uuid,name:"",enabled:a.compat_arrayleft},f),B=n.createCheckbox(c.getMessage("Add_toSource_function_to_Object_Prototype"),{id:"compat_prototypes",uuid:a.uuid,name:"",enabled:a.compat_prototypes},f);const D=[E,A,L,V,S,T,B];E=g("div","section",a.uuid,"ta_opt");L=g("div","section_head",a.uuid,"head_ta_opt");A=g("div","section_content",a.uuid,"content_ta_opt");L.textContent=c.getMessage("Settings");E.appendChild(L);E.appendChild(A);L=g("div","section",a.uuid,"ta_upd");S=g("div","section_head",a.uuid,
"head_ta_upd");V=g("div","section_content",a.uuid,"content_ta_upd");S.textContent=c.getMessage("Updates");L.appendChild(S);L.appendChild(V);S=g("div","section",a.uuid,"ta_cludes");B=g("div","section_head",a.uuid,"head_ta_cludes");T=g("div","section_content",a.uuid,"content_ta_cludes");B.textContent=c.getMessage("Includes_Excludes");S.appendChild(B);S.appendChild(T);B=g("div","section",a.uuid,"ta_security");var J=g("div","section_head",a.uuid,"head_ta_security");const I=g("div","section_content",a.uuid,
"content_ta_security");J.textContent=c.getMessage("XHR_Security");B.appendChild(J);B.appendChild(I);J=g("div","section",a.uuid,"ta_compat");const O=g("div","section_head",a.uuid,"head_ta_compat"),hb=g("div","section_content",a.uuid,"content_ta_compat");O.textContent=c.getMessage("GM_compat_options_");J.appendChild(O);J.appendChild(hb);A.appendChild(m);A.appendChild(h);A.appendChild(l.elem);A.appendChild(k.elem);m=n.createButton("save_update_button",a.uuid,c.getMessage("Save"),()=>{f.apply(F.input,
[]);a.is_external||f.apply(r.input,[])});V.appendChild([F.elem,r.elem,m]);T.appendChild([t.elem,x.elem,p.elem,z,K.elem,G.elem,v.elem]);I.appendChild([w.elem,u.elem,C.elem,q.elem]);e.appendChild([E,L,S,B]);for(t=0;t<D.length;t++)hb.appendChild(D[t].elem);a.awareOfChrome&&Object.keys(D).forEach(a=>{D[a].input.setAttribute("disabled","disabled");D[a].elem.setAttribute("title",c.getMessage("This_script_runs_in_Chrome_mode"))});e.appendChild(J);const Ma=n.createTextarea(null,{name:"",uuid:a.uuid,id:"comment",
value:a.options.comment});Ma.elem.setAttribute("class","script_setting_wrapper");t=y("div",a.uuid,"save");x=n.createButton("save_button",a.uuid,c.getMessage("Save"),()=>{f.apply(Ma.textarea,[])});t.appendChild(x);x=g("div","section",a.uuid,"ta_comment");p=g("div","section_head",a.uuid,"head_ta_comment");z=g("div","section_content",a.uuid,"content_ta_comment");p.textContent=c.getMessage("Comment");x.appendChild(p);x.appendChild(z);z.appendChild(Ma.elem);z.appendChild(t);e.appendChild(x);t=g("div",
"section",a.uuid,"ta_det");x=g("div","section_head",a.uuid,"head_ta_det");p=g("div","section_content",a.uuid,"content_ta_det");x.textContent=c.getMessage("Details");t.appendChild(x);t.appendChild(p);x.textContent=c.getMessage("Details");const ib=g("table","script_details",a.uuid,"script_details");[{label:c.getMessage("Size"),value:pa.formatBytes((a.code?a.code:a).length,2)},{label:c.getMessage("UUID"),value:a.uuid}].forEach(b=>{const c=g("tr","external_desc",a.uuid,b.label,"tr"),d=g("td","external_desc",
a.uuid,b.label,"td1"),e=g("td","",a.uuid,b.label,"td2");d.textContent=b.label;e.textContent=b.value;c.appendChild(d);c.appendChild(e);ib.appendChild(c)});p.appendChild(ib);e.appendChild(t);const Gb=b.appendTab("settings",d,e,a=>{a.then(()=>{N.setSub("settings")})});N.registerListener(a.uuid,"settings",()=>{Gb.select()});return{}},kb=(a,b,d,e)=>{const f=g("table","externals",a.uuid,"outer_req2html",b,!0);let m=0;const h=[{label:c.getMessage("URL"),prop:"display_url"},{label:c.getMessage("Size"),prop:"data",
fn:function(a){let b="?";a&&(void 0!==a.length?b=a.length:void 0!==a.content&&(b=a.content.length));return pa.formatBytes(b,2)}},{label:c.getMessage("MIME_Type"),prop:"mimetype"},{label:c.getMessage("Subresource_Integrity"),prop:"sri",fn:function(a){return a?a.type+"="+a.value:c.getMessage("_not_set_")}},{label:c.getMessage("Last_updated"),prop:"ts",fn:function(a){return a?(new Date(a)).toString():null}}];h.push({label:c.getMessage("User_modified"),prop:"modified",klass:"validation",title:c.getMessage("This_external_resource_will_not_auto_update__Please_delete_it_in_order_to_enable_updates_again_"),
icon:C.get("info"),fn:function(a){return a?c.getMessage("Yes"):null}});a[b].forEach(l=>{const k=m+w.createUniqueId(l.url)+b;h.forEach(b=>{var c;const d=g("tr","",a.uuid,b.prop,"tr"+k),e=g("td","external_label",a.uuid,b.prop,"td1"+k),h=g("td","external_desc",a.uuid,b.prop,"td2"+k);e.textContent=b.label;h.textContent=c=(b.fn?b.fn:a=>a)(l[b.prop]);null!==c&&(b.klass&&$(h).addClass(b.klass),b.title&&h.setAttribute("title",b.title),b.icon&&(c=g("span","validation",a.uuid,"validation","span"+k),c.appendChild(n.createIcon(b.icon+
" red","warning",a.uuid,k+"no_require_update_warning")),h.appendChild(c)),d.appendChild(e),d.appendChild(h),f.appendChild(d))});var p=g("tr","external_desc_buttons",a.uuid,l.url,"tr"+k);const r=g("td","",a.uuid,"buttons","td"+k);p.appendChild(r);f.appendChild(p);if(l.ts){if("requires"==b||l.editable){p=y("span",a.uuid,"edit_external"+k);const b=n.createImageTextButton(a.uuid,"edit_external"+k,c.getMessage("Edit"),"edit",()=>{Nb(d,a.uuid,l,e)});p.appendChild(b);r.appendChild(p)}p=y("span",a.uuid,"delete_external"+
k);const f=n.createImageTextButton(a.uuid,"delete_external"+k,c.getMessage("Delete"),"delete",()=>{vb(a.uuid,l.url);f.parentNode&&f.parentNode.removeChild(f)});p.appendChild(f);r.appendChild(p)}m++});if(!m){const b=g("tr","script_desc",a.uuid,m,"tr"),d=g("td","script_desc",a.uuid,m,"td1");d.textContent=c.getMessage("No_entry_found");b.appendChild(d);f.appendChild(b)}return f},Nb=(a,b,d,e)=>{const f="externals-"+b+"-"+d.url;v[f]={};const g=Ob({uuid:f,script_uuid:b,mimetype:d.mimetype,name:c.getMessage("Externals")+
" - "+d.url,file_url:d.url,referrer:"options.scripts.userscripts"},a,()=>{e(g.getEditor())},()=>{delete aa["tab"+f];delete aa["editor"+f];delete v[f]});g.show()},Lb=(a,b)=>{let d;const e=a=>{d=a},f=y("div","",a.uuid,"script_external_h");f.textContent=c.getMessage("Externals");const m=y("div","",a.uuid,"script_externals_c"),h=g("div","section",a.uuid,"ta_requires");var l=g("div","section_head",a.uuid,"head_ta_requires"),k=g("div","section_content",a.uuid,"content_ta_requires");l.textContent=c.getMessage("Requires");
h.appendChild(l);h.appendChild(k);k.appendChild(kb(a,"requires",b,e));l=g("div","section",a.uuid,"ta_resources");k=g("div","section_head",a.uuid,"head_ta_resources");const n=g("div","section_content",a.uuid,"content_ta_resources");k.textContent=c.getMessage("Resources");l.appendChild(k);l.appendChild(n);n.appendChild(kb(a,"resources",b,e));m.appendChild(h);m.appendChild(l);const r=b.appendTab("externals",f,m,a=>{a.then(()=>{N.setSub("externals")})});N.registerListener(a.uuid,"externals",()=>{r.select()});
return{getEditor:function(){return d}}},Kb=(a,b)=>{const d=(a,b)=>{if("string"===typeof a){const c=a[0];a=a.substr(1);switch(c){case "b":return"true"===a;case "n":return Number(a);case "o":try{return JSON.parse(a)}catch(x){console.log("values: parseValueFromStorage: "+x)}return b;default:return a}}else return b},e=y("div","",a.uuid,"script_storage_h");e.textContent=c.getMessage("Storage");const f=y("div","",a.uuid,"script_storages_c"),m=g("div","section",a.uuid,"ta_storage");var h=g("div","section_head",
a.uuid,"head_ta_storage");const l=g("div","section_content",a.uuid,"content_ta_storage");h.textContent=c.getMessage("Storage");m.appendChild(h);m.appendChild(l);const k=g("textarea","storageta",a.uuid,"storage");k.setAttribute("wrap","off");k.setAttribute("wrap","off");k.setAttribute("spellcheck","false");h=n.createButton("storage_save_button",a.uuid,c.getMessage("Save"),()=>{let b=null;try{b=JSON.parse(k.value)}catch(x){w.alert(c.getMessage("Unable_to_parse_this_"));return}const d=Object.keys(b),
e=Object.keys(a.storage);d.concat(e).filter((a,b,c)=>c.lastIndexOf(a)===b).forEach(c=>{if(!d.includes(c))db(a.uuid,c);else if(!e.includes(c)||b[c]!==a.storage[c]){var f=a.uuid;{var h=b[c];const a=(typeof h)[0];switch(a){case "o":try{h=a+JSON.stringify(h)}catch(G){console.log(G),h=void 0}break;default:h=a+h}}db(f,c,h)}})});l.appendChild(k);l.appendChild(h);f.appendChild(m);const F=b.appendTab("storage",e,f,a=>{a.then(()=>{N.setSub("storage")})});N.registerListener(a.uuid,"storage",()=>{(()=>{if(a.referrer&&
void 0===a.storage){const b=B();na({referrer:a.referrer+".storage",uuid:a.uuid},a=>{if(a.items){const c={},e=a.items[0];Object.keys(e).forEach(a=>{c[a]=d(e[a])});b.resolve(c)}else b.reject();p.hide()});return b.promise()}return B.Pledge(a.storage)})().done(b=>{k.value=k.value||JSON.stringify(b,null,4);a.storage=b;k.removeAttribute("disabled")}).fail(()=>{k.setAttribute("disabled",!0)});F.select()});return{}},jb=(a,b,d)=>{const e=g("tr","editor_container p100100",a.uuid,"container"),f=d.mimetype||
"text/javascript",m=!f||/(application|text)\/(?:x-)?(?:java|ecma)script/.test(f);if(!a.nnew&&O(a.uuid,"lastI"))return aa["editor"+a.uuid]||{};a.nnew&&(a.code=u.script_templates[0].value.replace("<$URL$>",ba.url?ia.Base64.decode(ba.url):"http://*/*"));const h=y("div",a.uuid,"script_editor_h"),l=h.inserted,k=y("div",a.uuid,"script_editor_c"),F=g("tr","editormenubar",a.uuid,"container_menu");var r=g("tr","editorbuttonbar",a.uuid,"container_button_menu"),q=g("table","editor_container_o p100100 noborder",
a.uuid,"container_o");q.appendChild(r);q.appendChild(F);q.appendChild(e);k.appendChild(q);const t=()=>{let b=!1;e.editor&&(b=u.editor_enabled?b|(e.editor.changed&&e.editor.mirror.historySize().undo):e.editor.value!=a.code);return b},x=()=>{CodeMirror.commands.trimTrailingSpacesIfEnabled(e.editor.mirror);O(a.uuid,"saveEm")},A=(a,b,c)=>{d.do_close&&d.do_close(b,c)};q=()=>{confirm(c.getMessage("Really_factory_reset_this_script_"))&&v[a.uuid].fullReset(a=>{a.cleaned&&d.do_close&&d.do_close(!0,!1)})};
var z=()=>{d.do_close&&d.do_close(!0,!1);v[a.uuid].deleteScript()};const K=a=>{e.editor.changed!=a&&(d.set_tab_class&&d.set_tab_class("modified",a),ca.toggleClass("modified",a));e.editor.changed=a};var G=()=>{window.setTimeout(()=>{let a;u.editor_enabled&&(a=e.editor)&&(p.wait(),window.setTimeout(()=>{(()=>{const b=a.mirror.performLint(!0);return b&&b.then?b:B.Pledge(b)})().then(()=>{const b=a.mirror.state.lint?a.mirror.state.lint.marked:null;if(b&&b.length){1===b.length?ab(c.getMessage("One_error_or_hint_was_found_")):
ab(c.getMessage("0count0_errors_or_hints_were_found_",b.length));for(let c,e=0;c=b[e];e++){let b;if(void 0!==c.line&&void 0!==c.column){b=c.line;var d=c.column}else c.lines&&c.lines.length&&(d=c.lines[0],b=d.lineNo()+1,d=d.markedSpans&&d.markedSpans.length?d.markedSpans[0].from+1:1);if(b&&d){a.mirror.setCursor(b-1,d-1);a.mirror.focus();break}}}else $a(c.getMessage("No_syntax_errors_were_found_"));p.hide()})},100))},1)};const D=g("td","",a.uuid,"editor_buttonmenu_td");r.appendChild(D);const R=g("ul",
"editormenu",a.uuid,"editormenu");r=g("td","",a.uuid,"editormenu_td");r.appendChild(R);let M,H;const E=(a,b)=>{let c,d;a&&(c=$(a),d=b?c.hasClass("visible"):!1);$("ul.editormenu .submenu").removeClass("visible");a?(c.toggleClass("visible",!d),H=d?null:a):H=null;a&&d||(M=a=>{let b;M&&(b=$(a.target))&&!b.closest(".editormenu").length&&(E(),document.body.removeEventListener("click",M),M=null)},document.body.addEventListener("click",M))},J=(b,c)=>{const d=g("li","entry",a.uuid,b,"editormenuentry",!0),
e=y("label",a.uuid,b,"editormenulabel_id");e.textContent=c;const f=g("table","submenu noborder",a.uuid,"editormenucontent"+b);d.appendChild([e,f]);d.addEventListener("click",a=>{$(a.target).closest(".entry").hasClass("list")||E(f,!0)});d.addEventListener("mousemove",function(){H&&H!=this&&E(f)});return{elem:d,content:f}},L=a=>()=>{e.editor.mirror.focus();e.editor.mirror.execCommand(a)},V={file:{text:c.getMessage("File"),entries:[{text:c.getMessage("Save"),command:"save",image:C.get("filesave"),cb:x},
{text:c.getMessage("Save_to_disk"),command:"save_to_disk",image:C.get("save_to_disk"),cb:()=>{O(a.uuid,"saveToDisk")}},{type:"sep"},{command:"cancel",text:c.getMessage("Editor_reset"),image:C.get("editor_cancel"),cb:()=>{confirm(c.getMessage("Really_reset_all_changes_"))&&e.editor&&(u.editor_enabled?(e.editor.mirror.setValue(a.code),K(!1)):e.editor.value=a.code)}}].concat(a.nnew||a.is_external?[]:[{type:"sep"},{text:c.getMessage("Remove"),command:"remove",image:C.get("delete"),cb:z}]).concat([{type:"sep"},
{text:c.getMessage("Close"),command:"close",image:C.get("exit"),cb:A}])},edit:{text:c.getMessage("Edit"),entries:[{text:c.getMessage("Undo"),command:"undo"},{text:c.getMessage("Redo"),command:"redo"},{type:"sep"},{text:c.getMessage("Cut"),command:"cut"},{text:c.getMessage("Copy"),command:"copy"},{text:c.getMessage("Paste"),command:"paste"},{text:c.getMessage("Select_All"),command:"selectAll"},{type:"sep"},{text:c.getMessage("Toggle_Comment"),command:"toggleComment"},{text:c.getMessage("Toggle_Comment_Indented"),
command:"toggleCommentIndented"},{text:c.getMessage("Toggle_Block_Comment"),command:"toggleBlockComment",modes:["js"]},{type:"sep"},{id:"edit_lines",text:c.getMessage("Lines"),modes:["js"],entries:[{text:c.getMessage("Indent"),command:"intelligentTab"},{text:c.getMessage("Indent_Less"),command:"indentLess"},{text:c.getMessage("Indent_More"),command:"indentMore"},{text:c.getMessage("Auto_Indent_all"),command:"reindentall"},{type:"sep"},{text:c.getMessage("Move_Line_Up"),command:"swapLineUp"},{text:c.getMessage("Move_Line_Down"),
command:"swapLineDown"},{text:c.getMessage("Duplicate_Lines"),command:"duplicateLine"},{text:c.getMessage("Delete_Line"),command:"deleteLine"},{text:c.getMessage("Join_Lines"),command:"joinLines"},{type:"sep"},{text:c.getMessage("Insert_Line_Before"),command:"insertLineBefore"},{text:c.getMessage("Insert_Line_After"),command:"insertLineAfter"}]},{id:"edit_text",text:c.getMessage("Text"),entries:[{text:c.getMessage("Upper_Case"),command:"upcaseAtCursor"},{text:c.getMessage("Lower_Case"),command:"downcaseAtCursor"},
{type:"sep"},{text:c.getMessage("Delete_Line_Left"),command:"delLineLeft"},{text:c.getMessage("Delete_Line_Right"),command:"delLineRight"},{text:c.getMessage("Delete_to_Previous_Word_Boundary"),command:"delGroupBefore"},{text:c.getMessage("Delete_to_Next_Word_Boundary"),command:"delGroupAfter"},{text:c.getMessage("Delete_Line"),command:"deleteLine"},{type:"sep"},{text:c.getMessage("Transpose"),command:"transposeChars"}]},{id:"edit_sort",text:c.getMessage("Sort"),entries:[{text:c.getMessage("Lines"),
command:"sortLines"},{text:c.getMessage("Line_Case_Insensitive"),command:"sortLinesInsensitive"}]},{id:"edit_folding",text:c.getMessage("Folding"),entries:[{text:c.getMessage("Fold"),command:"fold"},{text:c.getMessage("Unfold"),command:"unfold"},{text:c.getMessage("Fold_All"),command:"foldAll"},{text:c.getMessage("Unfold_All"),command:"unfoldAll"}]},{id:"edit_sublime_mark",text:c.getMessage("Sublime_Mark"),entries:[{text:c.getMessage("Set_Sublime_Mark"),command:"setSublimeMark"},{text:c.getMessage("Select_to_Sublime_Mark"),
command:"selectToSublimeMark"},{text:c.getMessage("Swap_with_Sublime_Mark"),command:"swapWithSublimeMark"},{text:c.getMessage("Delete_to_Sublime_Mark"),command:"deleteToSublimeMark"},{text:c.getMessage("Yank_Sublime_Mark"),command:"sublimeYank"}]}]},selection:{text:c.getMessage("Selection"),entries:[{text:c.getMessage("Incremental_Find"),command:"selectMatchingPartsOfCurrentSelection"},{text:c.getMessage("Add_Selection_Above"),command:"selectLinesUpward"},{text:c.getMessage("Add_Selection_Below"),
command:"selectLinesDownward"},{text:c.getMessage("Split_into_Lines"),command:"splitSelection"},{type:"sep"},{text:c.getMessage("Incremental_Find"),command:"selectMatchingPartsOfCurrentSelection"},{type:"sep"},{text:c.getMessage("Select_Line"),command:"selectLine"},{text:c.getMessage("Select_Scope"),command:"selectScope"},{text:c.getMessage("Select_Bookmarks"),command:"selectBookmarks"},{text:c.getMessage("Select_between_Brackets"),command:"selectBetweenBrackets"},{text:c.getMessage("Select_Next_Occurrence"),
command:"selectNextOccurrence"}]},find:{text:c.getMessage("Find"),entries:[{text:c.getMessage("Find"),command:"find"},{text:c.getMessage("Replace"),command:"replace"},{text:c.getMessage("Replace_All"),command:"replaceAll"},{type:"sep"},{text:c.getMessage("Find_Next"),command:"findNext"},{text:c.getMessage("Find_Previous"),command:"findPrev"},{text:c.getMessage("Find_Under"),command:"findUnder"},{text:c.getMessage("Find_All_Under"),command:"findAllUnder"},{text:c.getMessage("Find_Under_Previous"),
command:"findUnderPrevious"},{type:"sep"},{text:c.getMessage("Incremental_Find"),command:"selectMatchingPartsOfCurrentSelection"}]},goto:{text:c.getMessage("GoTo"),entries:[{text:c.getMessage("Jump_to_line"),command:"jump"},{text:c.getMessage("Document_Start"),command:"goDocStart"},{text:c.getMessage("Document_End"),command:"goDocEnd"},{text:c.getMessage("Group_Left"),command:"goGroupLeft"},{text:c.getMessage("Group_Right"),command:"goGroupRight"},{text:c.getMessage("Closing_Bracket"),command:"goToBracket"},
{text:c.getMessage("Line_Up"),command:"goLineUp"},{text:c.getMessage("Line_Down"),command:"goLineDown"},{type:"sep"},{text:c.getMessage("Center_Cursor"),command:"showInCenter"},{type:"sep"},{id:"bookmarks",text:c.getMessage("Bookmarks"),entries:[{text:c.getMessage("Toggle"),command:"toggleBookmark"},{text:c.getMessage("Clear_All"),command:"clearBookmarks"},{type:"sep"},{text:c.getMessage("Next_Bookmark"),command:"nextBookmark"},{text:c.getMessage("Prev_Bookmark"),command:"prevBookmark"}]}]},dev:{text:c.getMessage("Developer"),
entries:[{command:"macro",text:c.getMessage("Insert_constructor"),modes:["js"]}].concat(!a.system&&u.editor_enabled&&m?[{type:"sep"},{text:c.getMessage("Run_syntax_check"),command:"lint_script",image:C.get("check"),cb:G},{text:c.getMessage("Auto_Indent_all"),command:"reindentall"}]:[]).concat(a.nnew||a.is_external?[]:[{type:"sep"},{text:c.getMessage("Full_reset"),command:"reset",image:C.get("script_cancel"),cb:q}]).concat(a.nnew?[{type:"sep"},{id:"templates",text:c.getMessage("Templates"),entries:u.script_templates.map(a=>
({text:a.name,command:a.name,image:C.get("dot"),cb:function(){if(!t()||confirm(c.getMessage("Really_reset_all_changes_"))){var b=a.value;e.editor&&(u.editor_enabled?(e.editor.mirror.setValue(b),K(!1)):e.editor.value=b)}}}))}]:[])}},S=(a,b)=>{const c=b[0];let d,e;if(d=a[c])return S(d,b.slice(1));a.entries&&a.entries.some(a=>{if(a.command==c)return e=a,!0;if(a.entries&&(e=S(a,b)))return!0});return e};"file.save_to_disk file.save file.cancel dev.reset find.findNext find.findPrev edit.replace goto.jump edit.reindentall dev.lint_script file.close".split(" ").forEach(b=>
{(b=S(V,b.split(".")))&&(b.image?D.appendChild(n.createImageButton(a.uuid,b.id||b.command,b.text,b.image,b.cb||L(b.command))):D.appendChild(n.createButton(b.id||b.command,a.uuid,b.text,b.cb||L(b.command))))});const T=(a,b)=>{const c=b||CodeMirror.keyMap[u.editor_keyMap];let d,e;Object.keys(c).every(b=>c[b]==a?(d=b,!1):!0);if(d)return d;if(c.fallthrough&&(e=CodeMirror.keyMap[c.fallthrough])&&e!==c)return T(a,e)},I=(b,c)=>c.map((c,d)=>{if(!c.modes||c.modes.includes(m?"js":"other")){if("sep"==c.type){var e=
b+d;c=g("tr","entry sep",a.uuid,"editorsubmenusep_tr"+e);d=y("td",a.uuid,"editorsubmenusep_td"+e);e=y("hr",a.uuid,"editorsubmenusep"+e);d.setAttribute("colspan",4);c.appendChild(d);d.appendChild(e);return c}if(c.command){var f=b+"_"+c.command;var h=c.text,k=c.image;d=T(c.command);e=c.cb||L(c.command);c=!!c.cb||CodeMirror.commands.hasOwnProperty(c.command);var l=g("tr","entry "+(c?"":"disabled"),a.uuid,f,"editorsubmenuentry_tr",!0);var n=k?g("i","far fa-"+k,a.uuid,f,"editorsubmenuentry_i",!0):g("i",
"far",a.uuid,f,"editorsubmenuentry_i",!0);k=y("td",a.uuid,"editorsubmenuentry_td_i"+f);k.appendChild(n);n=g("td","label",a.uuid,"editorsubmenuentry_td_l"+f);n.textContent=h;f=g("td","shortcut",a.uuid,"editorsubmenuentry_td_m"+f);f.setAttribute("colspan",2);d&&(f.textContent=d);l.appendChild([k,n,f]);c&&l.addEventListener("click",e);return c=l}f=d=b+c.id;h=c.text;l=c.image;e=g("tr","entry list",a.uuid,f,"editorsubmenulistentry",!0);k=l?g("i","far fa-"+l,a.uuid,f,"editorsubmenulistentry_i",!0):g("i",
"far",a.uuid,f,"editorsubmenulistentry_i",!0);l=y("td",a.uuid,"editorsubmenulistentry_td_i"+f);l.appendChild(k);k=g("td","label",a.uuid,"editorsubmenulistentry_td_l"+f);k.textContent=h;n=g("td",a.uuid,"editorsubmenulistentry_td_m"+f);h=y("td",a.uuid,"editorsubmenulistentry_td_s"+f);e.appendChild([l,k,n,h]);l=g("span","submenulist",a.uuid,"editorsubmenulistcontent"+f);k=g("span","submenumore",a.uuid,"editorsubmenulistmore"+f);f=g("i","more far fa-caret-right",a.uuid,f,"editorsubmenulistentrymore_i",
!0);k.appendChild([f,l]);h.appendChild([f,k]);f=l;c=I(d,c.entries);if(0<c.length)return f.appendChild(c),e}}).filter(a=>a);Object.keys(V).forEach(a=>{const b=V[a],c=J(a,b.text);a=I(a,b.entries);0<a.length&&(R.appendChild(c.elem),c.content.appendChild(a))});q=g("textarea","editorta",a.uuid,"editor");q.setAttribute("wrap","off");q.setAttribute("spellcheck","false");z=g("td","editor_outer",a.uuid,"edit");G=g("div","editor_100 editor_border",a.uuid,"edit");z.appendChild(G);F.appendChild(r);e.inserted||
(G.appendChild(q),e.appendChild(z));v[a.uuid].saveToDisk=()=>{if(e.editor){var b=u.editor_enabled?e.editor.mirror.getValue():e.editor.value;p.wait();return ta().done(()=>{const c=new Blob([b],{type:"text/plain"});saveAs(c,w.safeFileName(a.name+(a.is_external?"":".user.js")))}).always(()=>{p.hide()})}};a.system||(v[a.uuid].saveEm=a.is_external?b=>{if(e.editor){var d=u.editor_enabled?e.editor.mirror.getValue():e.editor.value;sb(a.script_uuid,d,{url:a.file_url,mimetype:a.mimetype,auto_save:b&&b.auto_save}).done(a=>
{a.success?K(!1):a.aborted||b&&b.auto_save||(a.messages&&a.messages.errors&&a.messages.errors.length?w.alert(a.messages.errors.join("\n")):w.alert(c.getMessage("Unable_to_parse_this_")))})}}:b=>{if(e.editor){var f=!0;u.showFixedSrc&&(f=confirm(c.getMessage("Do_you_really_want_to_store_fixed_code_",c.getMessage("Show_fixed_source"))));var h=u.editor_enabled?e.editor.mirror.getValue():e.editor.value;f&&Ja(a.uuid,h,{clean:!1,new_script:a.nnew,auto_save:b&&b.auto_save,reload:!0,lastModTime:v[a.uuid].saveEm_lastModTime}).done(e=>
{e.installed?a.nnew?d.do_close&&d.do_close(!0,!1):(K(!1),e.lastModified&&(a.lastModTime=e.lastModified)):e.aborted||b&&b.auto_save||(e.messages&&e.messages.errors&&e.messages.errors.length?w.alert(e.messages.errors.join("\n")):w.alert(c.getMessage("Unable_to_parse_this_")))});return f}});const ca=b.insertTab(null,d.navid,h,k,a=>{a.then(()=>{N.setSub(d.navid);if(d.on_tab_select)d.on_tab_select()})},d.on_tab_close);ca.setHeading(d.tab_name||c.getMessage("Editor"),50);N.registerListener(a.uuid,d.navid,
()=>{ca.select();u.editor_enabled&&e.editor&&(e.editor.refresh(),e.editor.mirror.focus())});if(l)return aa["editor"+a.uuid];const P=(a,b,c,d)=>{a=d.getValue();if((a=d.getHelper(CodeMirror.Pos(0,0),"lint")(a,c,d))&&a.then)return a.then(b);b(a)},Q=a=>{ya("editor_theme",a,!0).done(()=>{$a("Theme switched to "+a)})},U=()=>{u.editor_autoSave&&t()&&O(a.uuid,"saveEm",{auto_save:!0})};b={getTab:function(){return ca},getEditor:function(){if(e.editor)return u.editor_enabled?e.editor.mirror:{save:x}},onShow:()=>
{(()=>{if(a.referrer&&void 0===a.code){const b=B();na(w.copy(d.tree_opts||{},{referrer:a.referrer+"."+d.treeid,uuid:a.uuid}),c=>{c.items?(a.code=c.items[0],b.resolve()):b.reject();p.hide()});return b.promise()}return B.Pledge()})().done(()=>{var b=k.getElementsByTagName("textarea");v[a.uuid].lastI=()=>a;if(b.length&&!e.editor){b=b[0];const h=()=>{e.editor&&K(!!e.editor.mirror.historySize().undo)};if(u.editor_enabled){const d=b.parentNode;d.removeChild(b);e.editor=new MirrorFrame(d,{mode:f,theme:u.editor_theme,
fontSize:u.editor_fontSize,themeOptions:{all:Qa.getEditorThemes().map(a=>a.value),onChange:Q},value:a.code,indentUnit:Number(u.editor_indentUnit),indentWithTabs:"tabs"==u.editor_indentWithTabs,smartIndent:"classic"!=u.editor_tabMode,indentByTab:"indent"==u.editor_tabMode,electricChars:"true"==u.editor_electricChars.toString(),lineNumbers:!0,lineWrapping:u.editor_lineWrapping,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:u.editor_keyMap,bookmarkGutter:!0,gutters:["gutter","CodeMirror-linenumbers",
"CodeMirror-foldgutter","CodeMirror-lint-markers","CodeMirror-bookmarks"],matchBrackets:!0,foldGutter:!0,styleActiveLine:!0,specifyMoreJsTokens:m,styleSelectedText:!0,autoTrimTrailingSpace:"true"==u.editor_trimTrailingSpacesFromModifiedLines.toString(),hintOptions:m?{keywords:Object.keys(Pa.globals)}:void 0,lint:m?{lintOnChange:u.editor_autoLint,autoLintMaxLen:u.editor_autoLintMaxLen,async:!0,getAnnotations:P,hint_config:u.editor_linter_config||Pa.config}:void 0,showTrailingSpace:u.editor_highlightTrailingWhitespace},
{save:x,close:A},{change:h,blur:U},c.getMessage)}else e.editor=b,b.value=a.code;if(d.on_editor_load)d.on_editor_load()}}).fail(()=>{d.do_close&&d.do_close(!1,!0)})},onClose:function(b){if(!b&&t()){if(b=confirm(c.getMessage("There_are_unsaved_changed_")))e.editor=null,delete v[a.uuid].lastI;return!b}e.editor=null;delete v[a.uuid].lastI;return!1}};return aa["editor"+a.uuid]=b},Ob=(a,b,c,e)=>{let d;a.is_external=!0;const g=()=>{d&&!h.onClose()&&(e(),d&&d.remove(),d=null)},h=jb(a,b,{tab_name:a.name,navid:a.uuid,
treeid:"external",mimetype:a.mimetype,tree_opts:{url:a.file_url,uuid:a.script_uuid},do_close:function(){window.setTimeout(g,100)},on_tab_close:g,on_tab_select:c,on_editor_load:c});d=h.getTab();h.show=()=>{h.onShow();d.select()};return h},Cb=(a,b,d)=>{v[a.uuid]||(v[a.uuid]={});let e,f;var m=a.icon,h=[];h.push("clickable");(a.blacklisted||a.foisted)&&h.push("crossedout");const l=g("span",h.join(" "),a.uuid,"sname");var k=g(m?"img":"span","nameNicon16 icon16 "+(m?"nameNicon16":"nameNOicon16"),a.uuid,
"sname_img");const p=g("span","nameNname16 "+(a.enabled?"":"greyed"),a.uuid,"sname_name");l.appendChild(k);h=Ea(a);var r=c.getTranslation(a,"name");p.textContent=r;var q=y("span",a.uuid,"spos");q.textContent=a.position||"";r=y("span",a.uuid,"sversion");r.textContent=a.version?a.version:"";m&&(k.src=a.icon);m=[];k=(a,b,c)=>{const d=g("span",c||"",a.uuid,"wrap");b&&("Array"===w.toType(b)?w.each(b,a=>{d.appendChild(a)}):d.appendChild(b));return d};const t=()=>{window.setTimeout(()=>{const c=Object.keys(Y);
for(let e,f=0;e=c[f];f++){const c=Y[e].script;if(c.uuid==a.uuid){xa(b,[c],null,d);break}}Ha()},1)},x=(b,c)=>{void 0===c&&(c=!b);f&&f.onClose&&f.onClose(b)||(a.uuid&&N.is(a.uuid)&&N.clear(),e&&(e.remove(),e=null),delete aa["tab"+a.uuid],delete aa["editor"+a.uuid],l.parentNode&&l.parentNode.removeChild(l),c&&t())},B=a=>{if(f&&f.onSelect)f.onSelect(a)},z=v[a.uuid].scriptClick=(h,k)=>{if(!e){{let h;a.nnew?(h=g("div","head_icon",a.uuid,"details_h"),h.appendChild(n.createIcon(a.image_id,"",a.uuid,"new_script_head"))):
h=y("div",a.uuid,"details_h");const k=y("div",a.uuid,"details_c");e=d.insertTab(null,a.uuid,h,k,B,a.nnew?null:x);a.nnew||e.setHeading(c.getMessage("Edit")+" - "+c.getTranslation(a,"name"),50);f=Mb(e,a,b,k,x)}}if(f&&f.onShow)f.onShow();e.show();h&&1==h.button||k||e.select();p.setAttribute("open","true")};"true"==p.getAttribute("open")&&z(null,!0);var K=(a,b)=>{a=a.getTime();b=b.getTime();var c=Math.abs(a-b);b=Math.round(c/6E4);a=Math.round(c/36E5);c=Math.round(c/864E5);return 60>=b?b+" min":48>=a?
a+" h":c+" d"};const G=y("span","",a.uuid,"last_updated",!0);let D="?";if(a.nnew||a.system)D="";else if(v[a.uuid].scriptUpdate=()=>{const b=G.textContent;G.textContent="";G.appendChild(n.createIcon(C.get("download"),"down",a.uuid,"spinner"));wb(a.uuid,d=>{G.textContent=b;d?($(G).addClass("green"),G.title=c.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),x(!0),cb()):($(G).addClass("red"),G.title=c.getMessage("No_update_found__sry_"))})},a.options.check_for_updates&&a.file_url&&"none"!=
a.file_url?(G.addEventListener("click",()=>{O(a.uuid,"scriptUpdate")}),G.setAttribute("class","clickable"),G.title=c.getMessage("Check_for_Updates")):(G.setAttribute("class","greyed italic"),G.title=c.getMessage("Update_check_is_disabled")),a.lastModified||a.lastUpdated)try{D=K(new Date,new Date(a.lastModified||a.lastUpdated))}catch(L){console.log("o: error calculating time "+L.message)}G.textContent=D;let R=y("div",a.uuid,"imported"),M="";J.push(()=>{u.sync_enabled&&(M=a.nnew||a.system?"":a.sync&&
a.sync.imported?a.sync.imported==ha.types.eCHROMESYNC?A.RUNTIME.FIREFOX?'<img src="'+C.brand("firefox")+'" class="icon16" title="Firefox Sync"/>':'<img src="'+C.brand("chrome")+'" class="icon16" title="Google Sync"/>':a.sync.imported==ha.types.eGDRIVE?'<img src="'+C.brand("gdrive")+'" class="icon16" title="Google Drive"/>':a.sync.imported==ha.types.eDROPBOX?'<img src="'+C.brand("dropbox")+'" class="icon16" title="Dropbox"/>':a.sync.imported==ha.types.eWEBDAV?'<img src="'+C.brand("webdav")+'" class="icon16" title="WebDAV"/>':
a.sync.imported==ha.types.eYANDEX?'<img src="'+C.brand("yandex")+'" class="icon16" title="Yandex"/>':a.sync.imported==ha.types.eONEDRIVE?'<img src="'+C.brand("onedrive")+'" class="icon16" title="OneDrive"/>':'<i class="icon16 far fa-'+C.get("question_mark")+'" />':"",R.innerHTML=M,R=null)});K=y("span",a.uuid,"hp");if(a.origin){var H=y("a",a.uuid,"hp_origin");H.setAttribute("href",a.origin.url);H.setAttribute("target","_blank");var E=n.createImage(C.origin(a.origin.token),"",a.uuid,a.origin.token);
H.appendChild(E);K.appendChild(H)}!h||a.origin&&a.origin.url===h||(H=y("a",a.uuid,"hp_script"),H.setAttribute("href",h),H.setAttribute("target","_blank"),E=n.createIcon(C.get("home"),"",a.uuid,"homepage",""),H.appendChild(E),K.appendChild(H));v[a.uuid].saveEm_lastModTime=a.lastModified;v[a.uuid].fullReset=c=>{Ja(a.uuid,null,{clean:!0,reload:!0}).done(c||(()=>{}));b.parentNode.removeChild(b)};v[a.uuid].reportAnIssue=b=>{xb(a.uuid,b)};v[a.uuid].deleteScript=(d,e)=>{1==(e||confirm(c.getMessage("Really_delete_0name0__",
a.name)))&&(Ja(a.uuid,null,{reload:!e}),b.parentNode.removeChild(b))};H=[];!a.nnew&&!a.system&&a.origin&&a.origin.abuse_url&&(E=n.createIcon(C.get("flag"),"",a.uuid,"issue",c.getMessage("Report_an_issue_to_the_script_hoster_"),()=>{O(a.uuid,"reportAnIssue","hoster")}),H.push(E));a.nnew||a.system||!a.origin&&!a.supportURL||(E=n.createIcon(C.get("bug"),"",a.uuid,"bug",c.getMessage("Report_a_bug"),()=>{O(a.uuid,"reportAnIssue","author")}),H.push(E));a.nnew||a.system||(a.remote_url&&(E=n.createIcon(C.get("cloud"),
"",a.uuid,"cloud_edit",c.getMessage("Edit"),()=>{sendMessage({method:"newTab",url:a.remote_url},()=>{})}),H.push(E)),E=n.createIcon(C.get("edit"),"",a.uuid,"edit",c.getMessage("Edit"),()=>{O(a.uuid,"scriptClick")}),H.push(E));a.nnew||a.system||(E=n.createIcon(C.get("delete"),"",a.uuid,"delete",c.getMessage("Delete"),()=>{O(a.uuid,"deleteScript")}),H.push(E));A.RUNTIME.MOBILE?l.inserted||p.addEventListener("click",()=>{$(b).toggleClass("show_details")}):l.inserted||(l.addEventListener("click",z),l.addEventListener("auxclick",
z));l.appendChild(p);E=[a.name];a.description&&E.push(c.getTranslation(a,"description"));if(a.blacklisted||a.foisted)E=[a.blacklisted||a.foisted];l.title=E.join("\n\n").replace(/"/g,'"');m.push(a.nnew||a.system?null:{element:Pb(a),style:"script_sel"});m.push(q);m.push((()=>{var b=null;b=a.blacklisted||a.foisted?"enabler_warning":a.enabled?a.contexter?"enabler_enabled enabler_later":"enabler_enabled":"enabler_disabled";const d=a.blacklisted||a.foisted||(a.enabled?c.getMessage("Enabled"):c.getMessage("Disabled"));
b=n.createEnabler(b,a.uuid,"enabled",{append:"enabled",disabled:!!a.blacklisted,title:d},()=>{O(a.uuid,"switchEnabled")});v[a.uuid].switchEnabled=(b,c,d)=>{void 0===c&&(c=!a.enabled);fa(a.uuid,{enabled:c,whitewash:!!a.foisted},d)};return b})());m.push({element:l,style:"script_name"});if(A.RUNTIME.MOBILE){q=(b,c,d,e)=>{const f=g("dt","script_info "+(e?e:""),a.name,a.uuid,"dt_mapping"+c);e=g("dd","script_info "+(e?e:""),a.name,a.uuid,"dd_mapping"+c);f.textContent=c;"string"===typeof d?e.textContent=
d:e.appendChild(d);b.appendChild([f,e])};E=g("dl","script_details",a.name,a.uuid,"script_details_dl");l.appendChild(E);q(E,c.getMessage("Version"),r);q(E,c.getMessage("Type"),lb(a),"script_type");q(E,c.getMessage("Sites"),mb(a));var I;(I=nb(a))&&q(E,c.getMessage("Features"),I);h&&q(E,c.getMessage("Homepage"),K);D&&q(E,c.getMessage("Last_updated"),G);m.push(k(a,H,"actions"))}else for(m.push({element:r,style:"script_version"}),m.push(lb(a)),m.push(R),m.push(mb(a)),m.push(nb(a)),m.push(K),m.push(G),
m.push(Qb(a)),m.push(k(a,H,"actions")),I=m.length;10>I;I++)m.push(null);N.registerListener(a.uuid,()=>{z()});a.nnew&&J.push(()=>{z(null,!0)});return m},lb=a=>{const b=g("span","script_type","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.userscript&&(a=n.createImage(C.origin("uso"),"",a.uuid,"user_script",c.getMessage("This_is_a_userscript")),b.appendChild(a));return b},nb=a=>{let b,d;let e=null;const f=[];if(a.nnew)return null;a.system&&(b=n.createIcon(C.get("lock"),"",a.uuid,"lock",c.getMessage("This_is_a_system_script")),
f.push(b));a.warnings&&a.warnings.forEach((c,d)=>{b=n.createIcon(C.get("critical"),"compat",a.uuid,"warning_"+d,c);$(b).addClass("flashing");f.push(b)});a.awareOfChrome&&(b=n.createImage("https://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",c.getMessage("This_script_runs_in_Chrome_mode")),f.push(b));if(a.requires.length){var g=!a.requires.filter(a=>a.modified).length;b=n.createIcon(C.get("script_download")+(g?"":" red"),"",a.uuid,"requires",w.map(w.select(a.requires,
a=>a&&a.url),a=>a.url).join("\n"),()=>{N.set(a.uuid,"externals")});f.push(b)}a.resources.length&&(g=!a.resources.filter(a=>a.modified).length,b=n.createIcon(C.get("resources")+(g?"":" red"),"",a.uuid,"resources",w.map(w.select(a.resources,a=>a&&a.url),a=>a.url).join("\n"),()=>{N.set(a.uuid,"externals")}),f.push(b));g=!1;var h={includes:!0,matches:!0};for(d in h)if(a[d]){for(h=0;h<a[d].length;h++)if(a[d][h]&&(0==a[d][h].search(/\/\^?http(s|\.\*?|s\?|\[[^\]]*s[^\]]*\]|\([^\)]*s[^\)]*\))+/)||0==a[d][h].search(/http[s\*]{1,1}|\*/))){b=
n.createIcon(C.get("encrypted"),"",a.uuid,"encrypt",c.getMessage("This_script_has_access_to_https_pages"));f.push(b);g=!0;break}if(g)break}const l={};a.grant.forEach(a=>{l[a]=!0});l.GM_xmlhttpRequest&&(b=n.createIcon(C.get("web"),"",a.uuid,"web",c.getMessage("This_script_has_full_web_access")),f.push(b));l.GM_setValue&&(b=n.createIcon(C.get("db"),"",a.uuid,"db",c.getMessage("This_script_stores_data")),f.push(b));l.unsafeWindow&&(b=n.createIcon(C.get("windowlist"),"",a.uuid,"unsafeWindow",c.getMessage("This_script_has_access_to_webpage_scripts")),
f.push(b));for(d in a.options)if(-1!=d.search("compat_")&&a.options[d]){b=n.createIcon(C.get("critical"),"compat",a.uuid,"crit",c.getMessage("One_or_more_compatibility_options_are_set"));f.push(b);break}f.length&&(e=y("span","",a.uuid,"pos_features",!0),e.appendChild(f,!0));return e},Rb=(()=>{let a=null,b=null,c=null,e=0,f=0,g=0;const h=b=>{var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"};let l,k,p;const r=c=>{if(a&&!l){var d=null;let a,z,x,t;h(c);k&&(window.clearTimeout(k),k=null);
for(;d!=g;)if(d=g,a=b.previousSibling,z=b.nextSibling,x=b.parentNode,t=q(b),c.pageY>t.y+e+f&&z){x.removeChild(z);x.insertBefore(z,b);g++;var m=!1}else c.pageY<t.y&&1<g&&(x.removeChild(a),z?x.insertBefore(a,z):x.appendChild(a),g--,m=!0);d=Math.min(.03*document.documentElement.clientHeight,100);if(void 0!==m){z=m?$(a):$(z);if(z.length&&!n.isScrolledIntoView(z,{padding:d})){m=m?z.offset().top-d-z.height():z.offset().top-document.documentElement.clientHeight+d+2*z.height();l=!0;const a=m-document.body.scrollTop;
$("html, body").animate({scrollTop:m},0,()=>{window.setTimeout(()=>{l=!1;k=window.setTimeout(()=>{k=null;p===c&&r({pageX:p.pageX,pageY:p.pageY+a})},100)},100)})}c.stopPropagation&&(c.stopPropagation(),c.preventDefault());p=c;return!1}}},q=a=>{a=a.getBoundingClientRect();return{x:Math.floor(a.left+window.pageXOffset),y:Math.floor(a.top+window.pageYOffset)}},t=d=>{a.style.position="static";const e={};e[a.key]=g;fa(a.uuid,e);a=b=c=null;document.removeEventListener("mousemove",r);document.removeEventListener("scroll",
r);document.removeEventListener("mouseup",t);d.stopPropagation();d.preventDefault();return!1};return{start:function(d,k){{const g=this.parentNode.parentNode,k=g.parentNode,l=k.parentNode.parentNode;a=this;b=k;e=b.offsetHeight;f=b.offsetHeight-g.clientHeight;c=q(l);c.x=-c.x-a.offsetWidth/2;c.y=-c.y-b.offsetHeight/2+2*f;a.style.position="absolute";h(d)}g=k;document.addEventListener("mousemove",r);document.addEventListener("scroll",r);document.addEventListener("mouseup",t);d.stopPropagation();d.preventDefault();
return!1}}})(),Qb=a=>{const b=g("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew)return b;"pos"==ea()&&"up"==ka()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){const d=g("span","clickable movable","position",a.uuid,!0);d.innerHTML="&#9776;";d.title=c.getMessage("Click_here_to_move_this_script");d.uuid=a.uuid;d.key="position";d.addEventListener("mousedown",function(b){Rb.start.apply(this,[b,a.position])});b.appendChild(d)}return b},mb=a=>{let b=y("span","",
a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=y("span","",a.uuid,"site_images"));Da.topIcons(a,7).forEach(a=>{b.appendChild(a,!0)});c&&c.parentNode.removeChild(c);return b},Ab=a=>{const b=g("div","search_filter",a.name,a.id,"filter");if(b.inserted)return b;const d=$(b);let e=null,f,m,h;const l=(a,b)=>{if(!f||a)e&&window.clearTimeout(e),r.show(),e=window.setTimeout(()=>{q=null;m=x;h=k.value;var a=document.getElementsByName("scriptselectors");const b=[];for(let c=0;c<
a.length;c++)b.push(a[c]);f=!0;"matching_url"!=m&&"auto"!=m||!h.match(t.matching_url.match)?a=B.Pledge():(u=t.matching_url.update_interval||u,a=qb(h));a.then(a=>{const c=new RegExp(w.escapeForRegExp(h),"i"),e=Oa.createQueue(32),f=[],g=b.map(b=>()=>{let e,g,l,n;if(!(g=Y[b.s_id])||!(l=g.script)||!(n=g.dom)||m!=x||h!=k.value)return B.Breach();f.push(()=>{$(n).toggle(!!e);b.is_hidden=!e});return(()=>{if(d.is(":visible")){if("auto"==m)return B.or(Object.keys(t).map(b=>()=>{const d=t[b];return d.check?
d.check(l,d.ignore_case?c:h,a):B.Breach()}));{const b=t[m];if(b.check)return b.check(l,b.ignore_case?c:h,a)}}else return B.Pledge();return B.Breach()})().done(()=>{e=!0}).fail(()=>{e=!1})});return B.sidebyside(g.map(a=>e.add(a))).always(()=>f.forEach(a=>a()))}).always(()=>{f=!1;m!=x||h!=k.value?l(!1,1):r.fadeOut()})},b||u)},k=g("input","filter_text","sms","all",null);k.setAttribute("spellcheck","false");let p="";k.inserted||k.addEventListener("keyup",()=>{p!=k.value&&(p=k.value,l())});const r=$(n.createIcon(C.get("download"),
"wait_for_filter",a.uuid));r.attr("style","vertical-align: middle;");r.hide();v.filter={onShow:function(a){l(!0);a&&$(k).focus()},onHide:function(){k.value="";l(!0,1)}};let q;const t={auto:{name:c.getMessage("Auto"),update_interval:500},name:{name:"@name",sync:function(a,b){return-1!=a.name.search(b)},ignore_case:!0},namespace:{name:"@namespace",sync:function(a,b){return a.namespace&&-1!=a.namespace.search(b)},ignore_case:!0},author:{name:"@author",sync:function(a,b){return a.author&&-1!=a.author.search(b)},
ignore_case:!0},grant:{name:"@grant",default:"GM_",sync:function(a,b){return a.grant&&0<a.grant.filter(a=>-1!=a.search(b)).length},ignore_case:!0},includes:{name:"@include/@match",sync:function(a,b){return a.includes&&0<a.includes.filter(a=>-1!=a.search(b)).length||a.matches&&0<a.matches.filter(a=>-1!=a.search(b)).length},ignore_case:!0},code:{name:c.getMessage("Source_Code"),async:function(a,b){const c=B();if(!q){const a=B();q=a.promise();ub(null,{code:b.toString()},b=>{a.resolve(b)})}q.done(b=>
{window.setTimeout(()=>{(b.includes(a.uuid)?c.resolve:c.reject)()},0)});return c.promise()},ignore_case:!0},comment:{name:c.getMessage("Comment"),sync:function(a,b){return a.comment&&-1!=a.comment.search(b)},ignore_case:!0},url:{name:c.getMessage("Update_URL_"),default:"https://",sync:function(a,b){return a.file_url&&-1!=a.file_url.search(b)},ignore_case:!0},matching_url:{name:c.getMessage("Matching_URL"),update_interval:1500,default:"http://",match:/^https?:\/\/.*/,sync:function(a,b,c){return c&&
c.includes(a.uuid)}}};Object.keys(t).forEach(a=>{const b=t[a];b.check=b.sync||b.async?function(){if(b.sync)return b.sync.apply(this,arguments)?B.Pledge():B.Breach();if(b.async)return b.async.apply(this,arguments)}:null});let x="auto",u=t.auto.update_interval;a=n.createDropDown(c.getMessage("Filter_by"),{value:0,uuid:"sms-filter",name:"select"},Object.keys(t).map(a=>({name:t[a].name,value:a})),function(){var a=this.value;a!=x&&(x=a,u=((a=t[x])?a.update_interval:null)||t.auto.update_interval,a=(a?a.default:
null)||"",k.value=k.value||a,l())});a.elem.setAttribute("class","label");b.appendChild(a.elem);b.appendChild(k);b.appendChild(r[0]);ba.filter&&J.push(()=>{v.multiselect.toggleRow(!0,!0);k.value=ba.filter});return b};let X=[];const Pb=a=>{const b=y("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.inserted||b.addEventListener("click",a=>{X=[];b&&X.push(b);a.ctrlKey||a.metaKey?v.multiselect.un_selectAll():v.multiselect.single_click()});return b},zb=a=>{const b=g("input",
"multiselectcb","sms","all",null),d=g("div","filter multiselectcb clickable","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",v.multiselect.un_selectAll),d.addEventListener("click",()=>{v.multiselect.toggleRow()}));let e=0;var f=[{name:c.getMessage("__Please_choose__"),value:0},{name:c.getMessage("Enable"),value:1},{name:c.getMessage("Disable"),value:2},{name:c.getMessage("Toggle_Enable"),value:7}];(A.RUNTIME.CAN_SAVEAS_ZIP||"undefined"!==typeof Blob)&&f.push({name:c.getMessage("Export"),
value:3});f=f.concat([{name:c.getMessage("Trigger_Update"),value:5},{name:c.getMessage("Factory_Reset"),value:8},{name:c.getMessage("Remove"),value:6}]);f=n.createDropDown(c.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},f,function(){0==this.value?m.setAttribute("disabled","true"):m.removeAttribute("disabled");e=this.value});const m=n.createButton("MultiSelectButton","start_button",c.getMessage("Start"),()=>{if(0==e)console.log("option: ?!?!");else{var a=
null;6==e?a=c.getMessage("Really_delete_the_selected_items_"):8==e&&(a=c.getMessage("Really_factory_reset_the_selected_items_"));if(!a||confirm(a)){var b=document.getElementsByName("scriptselectors"),d=[];for(a=0;a<b.length;a++)d.push(b[a]);b={};var f=!1,g=100;for(a=0;a<d.length;a++)if(d[a].checked&&!d[a].is_hidden)if(1==e||2==e||7==e){var m="switchEnabled";let b;const c=Y[d[a].s_id]?Y[d[a].s_id].script:null;7==e?c&&(b=!c.enabled||!!c.foisted):2==e&&c&&c.foisted||(b=1==e);void 0!==b&&(O(d[a].s_id,
m,null,b,!1),f=!0)}else 3==e?b[d[a].s_id]=!0:5==e?(m="scriptUpdate",O(d[a].s_id,m)):6==e?(m="deleteScript",O(d[a].s_id,m,null,!0),f=!0,g=1500):8==e&&(m="fullReset",O(d[a].s_id,m),f=!0,g=1500);3==e&&(p.wait(),za(b,{storage:D.script_storage,externals:D.include_externals}).then(a=>{p.wait();return A.RUNTIME.CAN_SAVEAS_ZIP?da.zip.create(a.scripts).progress(p.wait):da.json.create(a.scripts).then(a=>new Blob([a],{type:"text/plain"}))}).then(a=>ta().done(()=>{saveAs(a,"tampermonkey_scripts"+(A.RUNTIME.CAN_SAVEAS_ZIP?
".zip":".txt"))})).always(()=>{p.hide()}));f&&(p.wait(c.getMessage("Please_wait___")),window.setTimeout(()=>{cb()},g))}}});m.setAttribute("class","action_button");m.setAttribute("disabled","true");f.elem.appendChild(m);a=g("div","actions",a.name,a.id,"actions");a.appendChild(f.elem);f=n.createButton("MultiSelectButton","close_button",c.getMessage("Close"),()=>{v.multiselect.toggleRow(!1)});$(f).addClass("close_button");return{selAllm:b,selAll:d,actionBox:a,close:f}};(()=>{let a=0;v.multiselect={};
let b=!1;v.multiselect.toggleRow=(a,c)=>{const d=$(".multiselect");void 0===a&&(a=!b);a?(b=!0,d.addClass("multiselectvisible"),v.filter.onShow(c)):(b=!1,d.removeClass("multiselectvisible"),v.filter.onHide(),v.multiselect.un_selectAll(!1))};v.multiselect.single_click=()=>{let b=0;const c=document.getElementsByName("scriptselectors");let f=!0,g=!1,h=0;for(let a=0;a<c.length;a++){g=!0;f=f&&c[a].checked;const b=$(c[a]).closest("tr");c[a].checked?(h++,b.addClass("selected")):b.removeClass("selected")}g&&
f&&(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=b?"checked":""));h&&v.multiselect.toggleRow(!0);v.multiselect.checkScroll&&v.multiselect.checkScroll()};v.multiselect.un_selectAll=b=>{3<++a&&(a=0);1==a&&a++;let c=!1,d=0;const g=document.getElementsByName("scriptselectors");X=[];!0===b&&(a=2);for(let e=0;e<g.length;e++){const f=$(g[e]).closest("tr");!1===b?(g[e].checked=!1,f.removeClass("selected")):(0==e&&3==a&&(a=0),c=!0,g[e].checked=3==a||2==a,g[e].checked?(d++,f.addClass("selected"),
X.push(g[e])):f.removeClass("selected"));d&&v.multiselect.toggleRow(!0)}void 0===b?1<a&&!c&&(a=0):b||(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"")}})();const Za={};rea.extension.onMessage.addListener((a,b,c)=>{if("updateOptions"==a.method)u=a.options||u,W(a.items,!1),c({});else if("confirm"==a.method)w.confirm(a.msg,a=>{c({confirm:a})});else if("showMsg"==a.method)w.alert(a.msg),c({});else if("status"==a.method)Fa(a.options),c({});else return!1;return!0});pa.addStyle(()=>{Ib(!0);na({referrer:"options"},
a=>{if(a.options&&a.options.layout_user_css&&"reset"!==ba.layout){const b=document.createElement("style");b.innerHTML=a.options.layout_user_css;(document.head||document.body||document.documentElement||document).appendChild(b)}u=a.options||u;a.version&&(Sa=a.version,g("div","version","version","version").textContent="v"+Sa+" by Jan Biniok");!Ca&&a.xhr&&(Ca=Registry.get("xmlhttprequest"),Ca.setConfig(a.xhr));a.items?(W(a.items,!1),a.begging&&J.push(()=>{window.setTimeout(()=>{Va(a.begging)},100)})):
p.hide()})})})});
