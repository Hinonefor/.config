"use strict";var infinityDrag={dragSlideLock:!1,dragShadow:document.createElement("div"),dragShadowHide:document.createElement("div"),isDraging:!1,init:function(){var e=this;e.ondrag(),e.dragShadow.className="home-drag-shadow",$(e.dragShadow).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>'),e.dragShadowHide.className="home-drag-shadow home-drag-shadow-hide",$(e.dragShadowHide).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>')},start:{},end:{},setDropPosition:function(a,n,t){var r=n;if(a[n].length<=t)return a;return function e(){var i=0;return a[r+=1]?a[r].length>t?(i=a[r-1][t],a[r].unshift(i),a[n].splice(t,1),void e()):(i=a[r-1][t],a[r].unshift(i),a[n].splice(t,1),a):(i=a[r-1][t],a[r]=[],a[r].unshift(i),a[n].splice(t-1,1),a)}()},checkEndPageIsFull:function(){var e=this;if(e.start.page!=e.end.page){if(SETTING.row*SETTING.column<=$(".group:nth-child("+(e.end.page+1)+")").children(".icon-item-out").length)return infinity.alert({html:infinity.i18n("this_page_no_space")}),!0;infinity.alertHide()}else infinity.alertHide();return!1},ondrag:function(){var d=this;d.isDraging=!0,$(document).on("drag",".icon-item-out",function(e){$(this).before(d.dragShadow),$(d.dragShadow).show(),$(this).remove()}),$(document).on("dragstart",".icon-item-out",function(e){try{iEditDelete.end()}catch(e){}var i=$(this),a=(infinity.get("infinity-icons").length,i.index());d.start={page:_app.data.currentPage,position:a},d.end={page:_app.data.currentPage,position:a},$(".home-drag-hover").css("display","flex"),infinity.log(this),this.ondragend=function(){d.isDraging=!1;var e=$(d.dragShadow).index();d.end.position=e,d.end.page=_app.data.currentPage;var i=SETTING.row*SETTING.column,a=infinity.get("infinity-icons"),n=a[d.end.page].length,t=a[d.start.page][d.start.position];if(d.start.page==d.end.page)a[d.start.page].splice(d.start.position,1),a[d.end.page].splice(d.end.position,0,t);else if(!(i<=n)){a[d.end.page].splice(d.end.position,0,t),d.setDropPosition(a,d.end.page,i);var r=a[d.start.page].indexOf(t);a[d.start.page].splice(r,1)}a[d.start.page].length||a.splice(d.start.page,1),_app.data.groups=a,_app.render(),infinity.set("infinity-icons",a),$(".home-drag-hover").css("display","none"),infinity.sendMessage("icon-handle",{type:"drag",page:d.end.page}),infinity.sendMessage("backupToCloud"),infinity.alertHide()}}),$(".home-drag-hover").on("dragenter",function(e){$(this).addClass("home-drag-hover-show");var i=parseInt($(this).attr("data-direction"));d.dragSlideLock||(d.dragSlideLock=!0,i?iView.slideToLeft(function(){if(iView.setPoniter(),d.end.page=_app.data.currentPage,d.dragSlideLock=!1,iView.lock=!1,!d.checkEndPageIsFull()){var e=_app.data.currentPage+1,i=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0];d.isDraging&&$(d.dragShadow).insertAfter(i)}}):iView.slideToRight(function(){if(iView.setPoniter(),d.end.page=_app.data.currentPage,d.dragSlideLock=!1,iView.lock=!1,!d.checkEndPageIsFull()){var e=_app.data.currentPage+1,i=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0];d.isDraging&&$(d.dragShadow).insertAfter(i)}}))}),$(".home-drag-hover").on("dragleave",function(e){$(".home-drag-hover").removeClass("home-drag-hover-show")}),$(document).on("dragover",".item-icon",function(e){e.preventDefault();var i=this;d.end.page=$(i).parents(".group").index(".group"),d.checkEndPageIsFull()||($(d.dragShadow).index()<$(i.parentNode).index()?$(d.dragShadow).insertAfter(i.parentNode):$(d.dragShadow).insertBefore(i.parentNode))})}};infinityDrag.init();