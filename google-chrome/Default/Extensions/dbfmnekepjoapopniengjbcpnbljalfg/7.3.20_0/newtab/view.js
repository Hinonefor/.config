"use strict";infinity.isMac=0<=navigator.platform.indexOf("Mac");var supportApps=["weather","todos","settings","notes","history","extension","bookmarks","gmail"],lethargyX=new Lethargy,lethargyY=new Lethargy(null,40,null,null),iView={isSliding:!1,slideSpeed:580,width:"1100px",_width:1100,isLockSlide:!1,init:function(){var r=this;!infinity.data("show-rate")&&2e3<=infinity.data("open-times")&&infinity.import("rate","body"),$(".app-box").on("mousewheel DOMMouseScroll wheel MozMousePixelScroll",".content",function(i,n){if(i.stopPropagation(),i.preventDefault(),_app.data.totalPages){var e=i.originalEvent,t=e.deltaX,o=e.deltaY,a=void 0,s=void 0;s=Math.abs(t)>Math.abs(o)?(a=lethargyX.check({deltaY:t}),0<t?-1:1):(a=lethargyY.check(i),0<o?-1:1),1==_app.data.totalPages?r.handleOnePageSlide(a):infinity.isMac?(1!=a||r.isSliding||r.slideToRight(function(){r.setPoniter()}),-1!=a||r.isSliding||r.slideToLeft(function(){r.setPoniter()})):(1!=s||r.isSliding||r.slideToRight(function(){r.setPoniter()}),-1!=s||r.isSliding||r.slideToLeft(function(){r.setPoniter()}))}}),$("#search-input").on("keydown",function(i){""!=i.target.value?r.isLockSlide=!0:r.isLockSlide=!1}),$("#search-input").on("blur",function(i){r.isLockSlide=!1}),$(document).on("keydown",function(i){!_app.data.totalPages||r.isLockSlide||(37!=i.which||r.isSliding||r.slideToRight(function(){r.setPoniter()}),39!=i.which||r.isSliding||r.slideToLeft(function(){r.setPoniter()}))}),r.onResize(),r.onClickIcon(),r.iLinkInit(),r.iInputClearInit(),r.handleMessage(),r.randowmWallpaper(),r.handlePointer(),r.handleTopSitesPermission(),r.onUpdate();try{document.getElementById("search-input").focus()}catch(i){}document.oncontextmenu=function(i){"INPUT"!=i.target.nodeName.toUpperCase()&&"TEXTAREA"!=i.target.nodeName.toUpperCase()&&i.preventDefault()}},iLinkInit:function(){$(document).on("click",".i-link",function(i){i.preventDefault();var n=$(this).attr("data-target"),e=$(this).attr("data-href");e&&infinity.open(n,e,i)})},iInputClearInit:function(){$(document).on("input",".i-input-clear input",function(){""!=$(this).val()&&$(this).parent().children("i.i-clear").show()}),$(document).on("click",".i-clear",function(i){i.preventDefault();var n=$(this).parent().children("input")[0];n.value="",n.focus(),$(this).hide()})},setPoniter:function(){$(".point-item").removeClass("point-select-true"),$(".point-item:nth-child("+(_app.data.currentPage+1)+")").addClass("point-select-true")},onResize:function(){var i=$.throttle(0,_app.setZoom);window.onresize=function(){i()}},handleOnePageSlide:function(i){var n=this;function e(i){n.isSliding=!0,$(".point-item:only-child").addClass("point-item-show-important"),$(".group-out").transition({x:i},240,function(){$(".group-out").transition({x:"0"},300,function(){$(".point-item:only-child").removeClass("point-item-show-important"),setTimeout(function(){n.isSliding=!1},0)})})}1!=i||n.isSliding||e("90px"),-1!=i||n.isSliding||e("-90px")},slideToPage:function(i,n,e){var t=this;_app.data.currentPage=i;var o=-1*parseInt(t.width)*_app.data.currentPage;$(".group-out").transition({x:o,duration:n,easing:"easeOutBack",complete:function(){t.setPoniter(),e&&e(),setTimeout(function(){t.isSliding=!1},0)}})},slideToLeft:function(i){var n=this;n.isSliding=!0;var e=null;_app.data.currentPage+1===_app.data.totalPages&&(e=$(".group:first").clone(),$(".group-out").append(e)),$(".group-out").transition({x:"-="+n.width,duration:n.slideSpeed,easing:"easeOutBack",complete:function(){_app.data.currentPage+1===_app.data.totalPages?($(".group-out").transition({x:0,duration:0}),e.remove(),_app.data.currentPage=0):_app.data.currentPage+=1,i&&i(),setTimeout(function(){n.isSliding=!1},0)}})},slideToRight:function(i){var n=this;n.isSliding=!0;var e=null;if(0===_app.data.currentPage){var t=$(".group:last").clone();e=$('<div class="group-first"></div>'),$(".group-out").prepend(e),e.html(t)}$(".group-out").transition({x:"+="+n.width,duration:n.slideSpeed,easing:"easeOutBack",complete:function(){try{e.remove(),$(".group-out").css({transform:"translate("+-(_app.data.totalPages-1)*n._width+"px, 0px)"}),_app.data.currentPage=_app.data.totalPages}catch(i){}--_app.data.currentPage,i&&i(),setTimeout(function(){n.isSliding=!1},50)}})},handlePointer:function(){var e=this;$(document).on("click",".point-item",function(i){i.preventDefault();var n=parseInt(i.target.dataset.index);e.slideToPage(n,500,function(){})})},showCover:function(){this.isLockSlide=!0,infinity.fadeIn(".masking-cover","block","0.2s",function(){})},hideCover:function(){infinity.fadeOut(".masking-cover","none","0.2s",function(){$(".masking-cover").hide(),self.isLockSlide=!1})},handleTopSitesPermission:function(){$(document).on("click","#startTopSites",function(i){chrome.permissions.request({permissions:["topSites"],origins:["chrome://favicon/"]},function(i){i&&chrome.topSites.get(function(i){infinity.set("infinity-topsites",i),_app.renderMostVisited()})})})},requestPermissionAndOpen:function(n){var e=this;"history"==n?chrome.permissions.request({permissions:["history"],origins:["chrome://favicon/"]},function(i){i?infinity.import(n,".side-all",function(){$(".i-"+n).removeClass("i-side-hide"),$(".i-"+n)[0].offsetHeight,$(".i-"+n).addClass("i-side-show")}):e.hideCover()}):"bookmarks"==n?chrome.permissions.request({permissions:["bookmarks"],origins:["chrome://favicon/"]},function(i){i?infinity.import(n,".side-all",function(){$(".i-"+n).removeClass("i-side-hide"),$(".i-"+n)[0].offsetHeight,$(".i-"+n).addClass("i-side-show")}):e.hideCover()}):"extension"==n&&chrome.permissions.request({permissions:["management"]},function(i){i?infinity.import(n,".side-all",function(){$(".i-"+n).removeClass("i-side-hide"),$(".i-"+n)[0].offsetHeight,$(".i-"+n).addClass("i-side-show")}):e.hideCover()})},isSupport:function(e){return supportApps.some(function(i,n){return i==e})},onClickIcon:function(){var o=this;$(document).on("mousedown",".item-icon",function(i){try{if(1==i.button){var n=JSON.parse(decodeURIComponent($(this).attr("data-icon"))).url;0==n.indexOf("http://")||0==n.indexOf("https://")?chrome.tabs.create({url:n,active:!1}):i.target.click(),i.preventDefault()}}catch(i){}}),$(document).on("click",".item-icon",function(i){i.preventDefault();try{var n=JSON.parse(decodeURIComponent($(this).attr("data-icon"))).url;if(0==n.indexOf("infinity://")){var e=n.replace("infinity://","");if(o.isSupport(e)){if("gmail"==e)return void infinity.open("isOpenLinkInNewTab","https://mail.google.com/mail/u/0/#inbox",i);o.showCover(),"chrome-apps"==e&&(e="extension"),"history"==e||"bookmarks"==e||"extension"==e?o.requestPermissionAndOpen(e):infinity.import(e,".side-all",function(i){$(".i-"+e).removeClass("i-side-hide"),$(".i-"+e)[0].offsetHeight,$(".i-"+e).addClass("i-side-show"),"weather"===e&&i.onOpen()})}else{var t=void 0;t="Chrome"==infinity.browser?'&nbsp;<a class="i-link" data-href="https://chrome.google.com/webstore/detail/infinity-new-tab-pro/nnnkddnnlpamobajfibfdgfnbcnkgngh" data-target="_blank">Infinity New Tab (Pro)</a>':'&nbsp;<a class="i-link" data-href="https://addons.mozilla.org/firefox/addon/infinity-new-tab-pro-firefox/" data-target="_blank">Infinity New Tab (Pro)</a>',infinity.alert({html:infinity.i18n("not_support",t),isShowCloseBtn:!0,isShowOkBtn:!0,okBtn:infinity.i18n("got_it"),isShowBackCover:!0})}}else 0==n.indexOf("app://")?chrome.permissions.request({permissions:["management"]},function(i){i?chrome.management.launchApp(n.replace("app://",""),function(){chrome.runtime.lastError&&infinity.alert({html:infinity.i18n("you_never_install_this_app"),autoCloseTime:1})}):o.hideCover()}):infinity.open("isOpenLinkInNewTab",n,i)}catch(i){}}),$(".home-btn").on("click",function(i){i.preventDefault(),o.showCover(),infinity.import("add",".side-all",function(){$(".i-add").removeClass("i-side-hide"),$(".i-add")[0].offsetHeight,$(".i-add").addClass("i-side-show"),$(".main").addClass("main-move")})}),$(".masking-cover").on("click",function(i){i.preventDefault(),o.hideSideBar()}),$(document).on("transitionend",".i-side",function(i){0<=i.target.className.indexOf("i-only-side")&&i.target.className.indexOf("i-side-show")<0&&$(i.target).addClass("i-side-hide")})},hideSideBar:function(){this.hideCover(),$(".i-side").removeClass("i-side-show"),$(".main").removeClass("main-move")},handleMessage:function(){var e=this;infinity.onMessage("updateGmailUnreadNum",function(){infinity.settings.load(),infinity.css.render()}),infinity.onMessage("updateLayout",function(){infinity.settings.load();var i=infinity.get("infinity-icons");_app.data.groups=i,_app.data.currentPage=0,_app.render(),e.slideToPage(0,0),$(".point-in").css("opacity","1")}),infinity.onMessage("settingChange",function(i){infinity.settings.load(),infinity.css.render(),i.type,_app.initTopBar(),"isShowSearchBtn"==i.type&&Search&&Search.reloadSetting()}),infinity.onMessage("icon-handle",function(i){var n=infinity.get("infinity-icons");_app.data.groups=n,_app.render(),"delete"!=i.type&&"drag"!=i.type||e.slideToPage(i.page,0)}),infinity.onMessage("onRecoverySetView",function(){infinity.settings.load(),infinity.css.render(),$(".bg").addClass("bg-transition"),_app.setWallpaper();var i=infinity.get("infinity-icons");_app.data.groups=i,_app.data.currentPage=0,_app.render(),e.slideToPage(0,0),_app.initTopBar(),SETTING.isShowTopBar&&"bookmarks"==SETTING.topBarType&&infinity.import("top-bookmarks","#bookmarkbar",function(){},!0)})},getRandomWallpaper:function(){var i=Math.floor(4050*Math.random())+1,n=infinity.wallpaper+"/wallpaper/"+i+".jpg";return infinity.setting("random-wallpaper",n),n},randowmWallpaper:function(){var t=this;windmill.init({el:document.getElementById("windmill"),maxSpeed:.66,accSpeed:.001,clockwise:!1}),$(".random-windmill").click(function(i){var n=t.getRandomWallpaper(),e=new Image;e.src=n,windmill.startRotateWindmill(),e.onload=function(){e.remove(),infinity.setting("wallpaperType","random"),setTimeout(function(){infinity.sendMessage("wallpaperChange"),infinity.sendMessage("backupToCloud")},500),setTimeout(function(){windmill.endRotateWindmill()},200)}})},onUpdate:function(){try{"on"==localStorage.showUpdateNote&&(localStorage.showUpdateNote="off",infinity.alert({html:"<div><br>"+infinity.i18n("we_update")+"<br><br><b>"+infinity.i18n("you_can_set_view")+"</b><br><br>"+infinity.i18n("feedback_us")+'<input class="can-select" type="text" readonly value="infinitynewtab@gmail.com" /></div>',isShowOkBtn:!0,isShowCloseBtn:!0}))}catch(i){}}};iView.init();