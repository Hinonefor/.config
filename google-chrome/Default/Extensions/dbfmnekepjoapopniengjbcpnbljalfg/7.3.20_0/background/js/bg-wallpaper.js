"use strict";window._wallpaper="";var bgWallpaper={init:function(i){var a=this;a.loadWallpaper(function(){i&&i()}),a.onChangeWallpaper(),a.checkBingWallpaper(),a.onSaveLocalWallpaper(),a.onSetDefaultWallpaper()},loadWallpaper:function(a){var n="",e="";infinity.get("infinity-wallpaper-base64",!0,function(i){i?(n=i,"FireFox"==infinity.browser?window._wallpaper="data:image/jpeg;base64,"+n:(e=infinity.base64toBlobUrl(n),infinity.set("infinity-wallpaper-blob",e),window._wallpaper=e),infinity.sendMessage("wallpaperTypeChange"),a&&a()):infinity.image2base64("/img/wallpaper/default.jpg",function(i){n=i,"FireFox"==infinity.browser?window._wallpaper="data:image/jpeg;base64,"+n:(e=infinity.base64toBlobUrl(n,"image/png"),infinity.set("infinity-wallpaper-blob",e),window._wallpaper=e),infinity.set("infinity-wallpaper-base64",n,!0),infinity.sendMessage("wallpaperTypeChange"),a&&a()})})},loadOldLocalWallpaper:function(a){var n=void 0,e=void 0;infinity.image2base64("filesystem:chrome-extension://dbfmnekepjoapopniengjbcpnbljalfg/temporary/local.jpg?time=randomstr",function(i){i?(n=i,"FireFox"==infinity.browser?window._wallpaper="data:image/jpeg;base64,"+n:(e=infinity.base64toBlobUrl(n,"image/png"),infinity.set("infinity-wallpaper-blob",e),window._wallpaper=e),infinity.set("infinity-wallpaper-base64",n,!0),infinity.sendMessage("wallpaperTypeChange"),a&&a()):a&&a(!1)})},checkBingWallpaper:function(){infinity.alarms.onAlarm("bingWallpaper",function(){$.ajax({url:"https://img.infinitynewtab.com/bingWallpaper/md5.json?t="+(new Date).getTime(),dataType:"json"}).done(function(i){infinity.setting("bingMd5",i.md5)})}),infinity.alarms.get("bingWallpaper",function(i){i||infinity.alarms.create("bingWallpaper",{periodInMinutes:10})})},onSaveLocalWallpaper:function(){infinity.onMessage("saveLocalWallpaper",function(i){var a=i.base64.split(";base64,")[1];if("FireFox"==infinity.browser)_wallpaper="data:image/jpeg;base64,"+a;else{var n=infinity.base64toBlobUrl(a);infinity.set("infinity-wallpaper-blob",n),_wallpaper=n}infinity.set("infinity-wallpaper-base64",a,!0),infinity.sendMessage("wallpaperTypeChange")})},onChangeWallpaper:function(){infinity.onMessage("wallpaperChange",function(){infinity.setting("wallpaperType");infinity.sendMessage("wallpaperTypeChange")})},onSetDefaultWallpaper:function(){var a="",n="";infinity.onMessage("setDefaultWallpaper",function(){infinity.image2base64("/img/wallpaper/default.jpg",function(i){a=i,_wallpaper="FireFox"==infinity.browser?"data:image/jpeg;base64,"+a:(n=infinity.base64toBlobUrl(a),infinity.set("infinity-wallpaper-blob",n),n),infinity.set("infinity-wallpaper-base64",a,!0),infinity.sendMessage("wallpaperTypeChange")})})}};