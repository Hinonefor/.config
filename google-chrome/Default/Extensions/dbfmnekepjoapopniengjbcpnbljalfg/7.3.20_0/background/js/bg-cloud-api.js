"use strict";var bgCloudApi={version:"1.0.0",init:function(){var e=this,i=chrome.runtime.getManifest();this.version=i.version,infinity.init("api-update-time-v2",{replaceSites:2,updateSearches:2,updateDiscovery:2,updateAdsInAdd:2}),infinity.init("api-update-time-v3",{_updateTime_:0}),infinity.alarms.onAlarm("checkApiUpdate",function(i){e.checkApiUpdate()}),infinity.alarms.create("checkApiUpdate",{periodInMinutes:120}),infinity.alarms.onAlarm("requestApiPerHour",function(i){e.apis.updateSearches(),e.apis.replaceSites()}),infinity.alarms.create("requestApiPerHour",{periodInMinutes:20}),infinity.onMessage("recoverySuccess",function(){e.apis.updateSearches()})},checkApiUpdateV3:function(){},checkApiUpdate:function(e){$.ajax({url:"https://infinity-basic.infinitynewtab.com/basic-api/update-time.json",dataType:"json",cache:!1}).done(function(i){infinity.set("api-update-time-v2",i),e&&e()})},apis:{updateSearches:function(){var i=infinity.get("api-update-time-v2");function t(i,e){var t=chrome.i18n.getUILanguage();i.logo=e.logo,i.name=e.name;var n=e.types.map(function(i,e){var n={};return n.name=i.name,i.url.hasOwnProperty(t)?n.url=i.url[t]:n.url=i.url.default,n});i.types=n}$.ajax({url:"https://basic-static-server.infinitynewtab.com/api2.0/searches/data.json?_t="+bgCloudApi.version+i.updateSearches,dataType:"json"}).done(function(i){var e=infinity.get("infinity-searches");i.searches.map(function(n,i){n.seId==e.current.seId&&t(e.current,n),e.all.map(function(i,e){i.seId==n.seId&&t(i,n)})}),infinity.set("infinity-searches",e)}).fail(function(i){})},replaceSites:function(){var i=infinity.get("api-update-time-v2");$.ajax({url:"https://infinity-basic.infinitynewtab.com/basic-api/replace-sites.json?_t="+bgCloudApi.version+i.replaceSites,dataType:"json"}).done(function(i){var e=infinity.get("infinity-icons"),r=i.sites.filter(function(i,e){return i.isEnabled});e.map(function(i,e){i.map(function(i,e){i.hasOwnProperty("updateTime")||(i.updateTime=0);for(var n=i.url,t=0;t<r.length;t++){var a=r[t];a.matches.some(function(i){return-1!=n.indexOf(i)})&&i.updateTime<a.updateTime&&(i.url=a.replaceUrl,a.isReplaceName&&(i.name=a.name),i.updateTime=a.updateTime)}})}),infinity.set("infinity-icons",e)})}}};