"use strict";var bgCloudIcon={init:function(){var i=this;infinity.data.init("icon-updata-time",0),i.onReload(),0==infinity.data("icon-updata-time")&&i.checkUpdate(),infinity.alarms.onAlarm("checkCloudIcon",function(n){i.checkUpdate()}),infinity.alarms.get("checkCloudIcon",function(n){n||infinity.alarms.create("checkCloudIcon",{periodInMinutes:120})}),i.handleMessage(),i.replaceSite()},handleMessage:function(){infinity.onMessage("bg-reCheckIsAdded",function(){infinity.sendMessage("reCheckIsAdded")}),infinity.onMessage("upload2Qiuniu",function(n,i,t){return infinity.uploadBase64Img({src:n.src,pre:900,scope:"custom-icon/",info:"basic-custom/",timeout:1e4,tokenTimeout:1e4},function(n,i){t(!n&&i)}),!0})},onReload:function(){var e=this;infinity.onMessage("cloud-api-reload",function(t,n,i){e.getData(t.type,function(n){var i={isOk:n,tabId:t.tabId};infinity.sendMessage("cloud-api-reload-response",i),e.getAllData(function(){})})})},checkUpdate:function(){var i=this,t=infinity.data("icon-updata-time");$.ajax({url:"https://icon-list.infinitynewtab.com/time/updateTime.json",dataType:"json",cache:!1}).done(function(n){n.time>t&&i.getAllData(function(){infinity.data("icon-updata-time",n.time)})})},getAllData:function(t){var e=this,a=["popular","games","shopping","music","photos","news","social","sports","life","app","education","tech","finance","read","others"],o=0;a.map(function(n,i){e.getData(n,function(){(o+=1)==a.length&&t&&t()})})},getData:function(i,t){var e=this,n="https://icon-list.infinitynewtab.com/"+(infinity.isZh()?"zh":"en")+"/"+i+".json?_t="+(new Date).getTime();$.ajax({url:n,dataType:"json"}).done(function(n){e.paging(n,i,function(){t&&t(!0)})}).fail(function(){t&&t(!1)})},paging:function(n,i,t){try{var e=_.chunk(n,50),a={name:i,pages:e.length,data:e};infinity.set("infinity-cloud-icon-"+i,a,!0,function(n){t&&t()})}catch(n){}},replaceSite:function(){},replaceJD:function(){}};