"use strict";!function(){var m=chrome.runtime.getManifest(),h=new InfinityGa({trackingId:"UA-130509779-1"});document.title=feedbackI18n.get("feedback_suggestion")+" - "+m.name;var c=document.getElementById("submit"),b=document.getElementById("text"),w=document.querySelector(".loading-out"),A=(document.querySelector(".spinner"),document.querySelector(".fb-email")),e=document.querySelector(".wp-upload"),k=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i;function S(){alert(feedbackI18n.get("feedback_success")),window.close()}var d=0;e.addEventListener("click",function(){infinity.chooseFile(null,function(e){var t=document.querySelector(".screen-shot-out"),n=document.querySelector(".icon-upload"),i=document.createElement("div");c.classList.add("icon-upload-disabled"),3<=d&&(n.style.display="none"),n.classList.add("icon-upload-disabled"),i.className="screen-shot-loading-out",i.innerHTML='<div class="screen-shot-loading-cover"></div><div class="screen-shot-failed-cover"></div><div class="screen-shot-loading spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><div class="screen-shot" style="background-image:url('+e.url+')"></div><div class="delete-upload"></div>',t.appendChild(i);var a=i.querySelector(".screen-shot-failed-cover"),s=i.querySelector(".delete-upload"),o=i.querySelector(".screen-shot-loading-cover"),l=i.querySelector(".screen-shot-loading");s.addEventListener("click",function(){"ok"==i.getAttribute("status")&&--d,d<4&&(n.style.display="block"),i.remove()}),infinity.uploadToQiniu(e.file,function(e){o.style.display="none",l.style.display="none",n.classList.remove("icon-upload-disabled"),s.style.display="block",e?(i.setAttribute("status","ok"),i.setAttribute("data-src",e),d+=1):(i.setAttribute("status","failed"),a.style.display="block"),c.classList.remove("icon-upload-disabled")})})}),c.addEventListener("click",function(){var e=b.value,t=A.value;if(""!=e.replace(/\s/g,""))if(""==t.replace(/\s/g,"")||k.test(t)){w.style.display="flex";for(var n=document.querySelectorAll(".screen-shot-loading-out"),i=Array.prototype.slice.call(n).map(function(e,t){return e.dataset.src}),a=URLSafeBase64.encode(e),s=splitter(a,350),o=[],l=Date.now()+""+randomString(2),c="N6taADrSL",d=0;d<s.length;d++){var r={a:l,t:"f",i:d,x:s[d],z:c};o.push(r)}var u={a:l,t:"i",l:chrome.i18n.getUILanguage(),v:m.version,s:!!m.hasOwnProperty("update_url"),w:window.screen.width,h:window.screen.height,d:window.devicePixelRatio,u:window.navigator.userAgent,to:"ontouchstart"in window,z:c},v={a:l,t:"e",e:t,z:c},g={a:l,t:"g",s:i,z:c};o.push(u,v,g);var y=0,f={s:"q9npW5P",n:DISPLAY_NAME.substr(0,30)};for(d=0;d<o.length;d++){var p=o[d];h.event({category:JSON.stringify(f),action:JSON.stringify(p)},function(){(y+=1)==o.length&&S()},function(){(y+=1)==o.length&&S()})}}else alert(feedbackI18n.get("please_input_valid_email"));else alert(feedbackI18n.get("please_input_feedback_first"))})}();