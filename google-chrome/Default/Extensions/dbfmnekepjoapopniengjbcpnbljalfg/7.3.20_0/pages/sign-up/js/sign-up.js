"use strict";var infinityApi="https://api.infinitynewtab.com",register=new Vue({el:"#register",template:"#J-register-template",data:{screenSize:!0,email:"",emailIsTrue:!1,clearEmail:!1,pwd:"",pwdIsTrue:!1,yzm:"",verify:"",yzmIsTrue:!1,clearPwd:!1,clearYzm:!1},created:function(){this.sendAjax("get","/verify.php",{},function(i){$("#verify").attr("src",i.img),this.verify=i.code}.bind(this))},mounted:function(){var i=document.getElementsByTagName("body")[0].offsetHeight;this.screenSize=!(i<540),window.onresize=function(i){var e=document.getElementsByTagName("body")[0].offsetHeight;this.screenSize=!(e<540)}.bind(this)},watch:{yzm:function(i){if(this.clearYzm=0<i.length,4<i.length){i=i.substring(0,4);this.yzm=i}md5(i)==this.verify?(this.yzmIsTrue=!0,$(".reginst-yzm-img").next().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.yzmIsTrue=!1,$(".reginst-yzm-img").next().removeClass("register-input-is-true").addClass("register-input-is-false"))},email:function(i){this.clearEmail=0<i.length},pwd:function(i){this.clearPwd=0<i.length}},methods:{registerEmailReg:function(){/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i.test(this.email)?(this.sendAjax("get","/checkName.php?name="+this.email,{},function(i){if("error"==i)return this.emailIsTrue=!1,void $(".register-input-email").html(infinity.i18n("net_error")).prev().removeClass("register-input-is-true").addClass("register-input-is-false");"Success"==i.desc&&"1"==i.message?(this.emailIsTrue=!0,$(".register-input-email").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.emailIsTrue=!1,$(".register-input-email").html(infinity.i18n("account_already_exists")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))}.bind(this)),this.emailIsTrue=!1,$(".register-input-email").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.emailIsTrue=!0,$(".register-input-email").html(infinity.i18n("format_error")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))},registerPwdReg:function(){/^[A-Za-z0-9_]{6,20}$/.test(this.pwd)?(this.pwdIsTrue=!0,$(".register-input-pwd").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.pwdIsTrue=!1,$(".register-input-pwd").html(infinity.i18n("password_min")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))},registerYzmReg:function(){md5(this.yzm)==this.verify?this.yzmIsTrue=!0:this.yzmIsTrue=!1},changeVerify:function(){this.sendAjax("get","/verify.php",{},function(i){this.yzmIsTrue=!1,$("#verify").attr("src",i.img),this.verify=i.code}.bind(this))},clearContent:function(i){this[i]="","email"==i?$(".register-input-"+i).html(infinity.i18n("must_fill")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"):"pwd"==i&&$(".register-input-"+i).html(infinity.i18n("must_fill")).prev().removeClass("register-input-is-true").addClass("register-input-is-false")},goSubmit:function(){if(this.emailIsTrue)if(this.pwdIsTrue)if(this.yzmIsTrue){var i={name:this.email,password:md5(this.pwd),code:this.yzm,version:2};this.sendAjax("get","/register.php",i,function(i){if("error"==i)return alert(infinity.i18n("net_error")+","+infinity.i18n("try_later")),this.changeVerify(),void(this.yzm="");if(1==i.message){var e=infinity.get("infinity-user");e.email=this.email,e.password=md5(this.pwd);try{e.name=this.email.split("@")[0]}catch(i){e.name="Spock Undefined"}e.isLogin=!0,e.backupTime=0,infinity.set("infinity-user",e),alert(infinity.i18n("sign_up_success")),infinity.sendMessage("userStatusChange"),infinity.sendMessage("signUpSuccess"),window.close()}else alert(infinity.i18n("server_error")+","+infinity.i18n("try_later")),this.changeVerify(),this.yzm=""}.bind(this))}else alert(infinity.i18n("invalid_verification_code_title"));else $(".register-input-pwd").html(infinity.i18n("password_min"));else $(".register-input-email").html(infinity.i18n("please_enter_format_email"))},sendAjax:function(i,e,t,s){$.ajax({type:i,url:infinityApi+e,dataType:"json",data:t,success:function(i){s&&s(i)},error:function(){s&&s("error")}})}}});